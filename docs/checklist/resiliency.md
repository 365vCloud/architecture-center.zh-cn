---
title: "复原能力查检表"
description: "为设计过程中的复原能力考虑因素提供指导的查检表。"
author: petertaylor9999
ms.date: 01/10/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: 51f807715d0ac929806b9a5a13da4efa00566592
ms.sourcegitcommit: a7aae13569e165d4e768ce0aaaac154ba612934f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/30/2018
---
# <a name="resiliency-checklist"></a><span data-ttu-id="8e30d-103">复原能力查检表</span><span class="sxs-lookup"><span data-stu-id="8e30d-103">Resiliency checklist</span></span>

<span data-ttu-id="8e30d-104">复原能力是指系统能够在发生故障后进行恢复，然后继续正常运行，它是[软件质量的构成要素](../guide/pillars.md)之一。</span><span class="sxs-lookup"><span data-stu-id="8e30d-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="8e30d-105">根据复原能力设计应用程序需要规划和缓解可能发生的各种故障模式。</span><span class="sxs-lookup"><span data-stu-id="8e30d-105">Designing your application for resiliency requires planning for and mitigating a variety of failure modes that could occur.</span></span> <span data-ttu-id="8e30d-106">使用此核对清单可以从复原能力的角度审查应用程序的体系结构。</span><span class="sxs-lookup"><span data-stu-id="8e30d-106">Use this checklist to review your application architecture from a resiliency standpoint.</span></span> 

## <a name="requirements"></a><span data-ttu-id="8e30d-107">要求</span><span class="sxs-lookup"><span data-stu-id="8e30d-107">Requirements</span></span>

<span data-ttu-id="8e30d-108">**定义客户的可用性要求。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-108">**Define your customer's availability requirements.**</span></span> <span data-ttu-id="8e30d-109">客户对应用程序的组件有可用性要求，这会影响应用程序设计。</span><span class="sxs-lookup"><span data-stu-id="8e30d-109">Your customer will have availability requirements for the components in your application and this will affect your application's design.</span></span> <span data-ttu-id="8e30d-110">让客户认可应用程序每个组成部分的可用性目标，否则设计可能不符合客户期望。</span><span class="sxs-lookup"><span data-stu-id="8e30d-110">Get agreement from your customer for the availability targets of each piece of your application, otherwise your design may not meet the customer's expectations.</span></span> <span data-ttu-id="8e30d-111">有关详细信息，请参阅[定义复原要求](../resiliency/index.md#defining-your-resiliency-requirements)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-111">For more information, see [Defining your resiliency requirements](../resiliency/index.md#defining-your-resiliency-requirements).</span></span>

## <a name="application-design"></a><span data-ttu-id="8e30d-112">应用程序设计</span><span class="sxs-lookup"><span data-stu-id="8e30d-112">Application Design</span></span>

<span data-ttu-id="8e30d-113">**对应用程序执行故障模式分析 (FMA)。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-113">**Perform a failure mode analysis (FMA) for your application.**</span></span> <span data-ttu-id="8e30d-114">FMA 是在设计阶段提前将复原能力整合到应用程序的过程。</span><span class="sxs-lookup"><span data-stu-id="8e30d-114">FMA is a process for building resiliency into an application early in the design stage.</span></span> <span data-ttu-id="8e30d-115">有关详细信息，请参阅[故障模式分析][fma]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-115">For more information, see [Failure mode analysis][fma].</span></span> <span data-ttu-id="8e30d-116">FMA 的目标包括：</span><span class="sxs-lookup"><span data-stu-id="8e30d-116">The goals of an FMA include:</span></span>  

* <span data-ttu-id="8e30d-117">识别应用程序可能遇到的故障类型。</span><span class="sxs-lookup"><span data-stu-id="8e30d-117">Identify what types of failures an application might experience.</span></span>
* <span data-ttu-id="8e30d-118">捕获每种故障对应用程序造成的潜在影响。</span><span class="sxs-lookup"><span data-stu-id="8e30d-118">Capture the potential effects and impact of each type of failure on the application.</span></span>
* <span data-ttu-id="8e30d-119">确定恢复策略。</span><span class="sxs-lookup"><span data-stu-id="8e30d-119">Identify recovery strategies.</span></span>
  

<span data-ttu-id="8e30d-120">**部署服务的多个实例。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-120">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="8e30d-121">如果应用程序依赖于服务的单个实例，则会造成单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-121">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="8e30d-122">预配多个实例能够提高复原能力和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-122">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="8e30d-123">对于 [Azure 应用服务](/azure/app-service/app-service-value-prop-what-is/)，请选择提供多个实例的[应用服务计划](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-123">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="8e30d-124">对于 Azure 云服务，请将每个角色配置为使用[多个实例](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-124">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="8e30d-125">对于 [Azure 虚拟机 (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，请确保 VM 体系结构包含多个 VM，并且每个 VM 包含在[可用性集][availability-sets]中。</span><span class="sxs-lookup"><span data-stu-id="8e30d-125">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>   

<span data-ttu-id="8e30d-126">**使用自动缩放来响应负载增加。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-126">**Use autoscaling to respond to increases in load.**</span></span> <span data-ttu-id="8e30d-127">如果应用程序未配置为随着负载的增加而自动横向扩展，当应用程序的服务中填满用户请求时，将会发生故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-127">If your application is not configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="8e30d-128">有关详细信息，请参阅以下文章：</span><span class="sxs-lookup"><span data-stu-id="8e30d-128">For more details, see the following:</span></span>

* <span data-ttu-id="8e30d-129">一般信息：[可伸缩性查检表](./scalability.md)</span><span class="sxs-lookup"><span data-stu-id="8e30d-129">General: [Scalability checklist](./scalability.md)</span></span>
* <span data-ttu-id="8e30d-130">Azure 应用服务：[手动或自动缩放实例计数][app-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="8e30d-130">Azure App Service: [Scale instance count manually or automatically][app-service-autoscale]</span></span>
* <span data-ttu-id="8e30d-131">云服务：[如何自动缩放云服务][cloud-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="8e30d-131">Cloud Services: [How to auto scale a cloud service][cloud-service-autoscale]</span></span>
* <span data-ttu-id="8e30d-132">虚拟机：[自动缩放和虚拟机规模集][vmss-autoscale]</span><span class="sxs-lookup"><span data-stu-id="8e30d-132">Virtual Machines: [Automatic scaling and virtual machine scale sets][vmss-autoscale]</span></span>

<span data-ttu-id="8e30d-133">**使用负载均衡分发请求。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-133">**Use load balancing to distribute requests.**</span></span> <span data-ttu-id="8e30d-134">负载均衡通过从轮转项目中删除不正常的实例，将应用程序请求分发到正常的服务实例。</span><span class="sxs-lookup"><span data-stu-id="8e30d-134">Load balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="8e30d-135">如果服务使用 Azure 应用服务或 Azure 云服务，则已均衡负载。</span><span class="sxs-lookup"><span data-stu-id="8e30d-135">If your service uses Azure App Service or Azure Cloud Services, it is already load balanced for you.</span></span> <span data-ttu-id="8e30d-136">但是，如果应用程序使用 Azure VM，则你需要预配负载均衡器。</span><span class="sxs-lookup"><span data-stu-id="8e30d-136">However, if your application uses Azure VMs, you will need to provision a load balancer.</span></span> <span data-ttu-id="8e30d-137">有关更多详细信息，请参阅 [Azure 负载均衡器](/azure/load-balancer/load-balancer-overview/)概述。</span><span class="sxs-lookup"><span data-stu-id="8e30d-137">See the [Azure Load Balancer](/azure/load-balancer/load-balancer-overview/) overview for more details.</span></span>

<span data-ttu-id="8e30d-138">**将 Azure 应用程序网关配置为使用多个实例。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-138">**Configure Azure Application Gateways to use multiple instances.**</span></span> <span data-ttu-id="8e30d-139">根据应用程序的要求，[Azure 应用程序网关](/azure/application-gateway/application-gateway-introduction/)可能更适合用于将请求分发到应用程序的服务。</span><span class="sxs-lookup"><span data-stu-id="8e30d-139">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="8e30d-140">但是，应用程序网关服务的单个实例不享有 SLA 保障，因此，洱应用程序网关实例发生故障时，应用程序也可能发生故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-140">However, single instances of the Application Gateway service are not guaranteed by an SLA so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="8e30d-141">预配多个中型或大型应用程序网关实例，保证根据 [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/) 的条款提供服务可用性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-141">Provision more than one medium or larger Application Gateway instance to guarantee availability of the service under the terms of the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/).</span></span>

<span data-ttu-id="8e30d-142">**为每个应用层使用 Azure 可用性集。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-142">**Use Availability Sets for each application tier.**</span></span> <span data-ttu-id="8e30d-143">将实例放入[可用性集][availability-sets]可提供更高的 [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-143">Placing your instances in an [availability set][availability-sets] provides a higher [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span> 

<span data-ttu-id="8e30d-144">**考虑跨多个区域部署应用程序。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-144">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="8e30d-145">如果将应用程序部署到单个区域，在发生整个区域不可用的情况时（这种情况很罕见），应用程序也不可用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-145">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="8e30d-146">根据应用程序的 SLA 条款，这种情况可能不可接受。</span><span class="sxs-lookup"><span data-stu-id="8e30d-146">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="8e30d-147">为此，请考虑跨多个区域部署应用程序及其服务。</span><span class="sxs-lookup"><span data-stu-id="8e30d-147">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="8e30d-148">多区域部署可以使用主动-主动模式（将请求分发到多个活动实例）或主动-被动模式（预留一个“热”实例，以防主实例发生故障）。</span><span class="sxs-lookup"><span data-stu-id="8e30d-148">A multi-region deployment can use an active-active pattern (distributing requests across multiple active instances) or an active-passive pattern (keeping a "warm" instance in reserve, in case the primary instance fails).</span></span> <span data-ttu-id="8e30d-149">我们建议跨区域对部署应用程序服务的多个实例。</span><span class="sxs-lookup"><span data-stu-id="8e30d-149">We recommend that you deploy multiple instances of your application's services across regional pairs.</span></span> <span data-ttu-id="8e30d-150">有关详细信息，请参阅[业务连续性和灾难恢复 (BCDR)：Azure 配对区域](/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-150">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

<span data-ttu-id="8e30d-151">**使用 Azure 流量管理器将应用程序的流量路由到不同的区域。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-151">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span>  <span data-ttu-id="8e30d-152">[Azure 流量管理器][traffic-manager]在 DNS 级别执行负载均衡，根据指定的[流量路由][traffic-manager-routing]方法和应用程序终结点的运行状况将流量路由到不同区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-152">[Azure Traffic Manager][traffic-manager] performs load balancing at the DNS level and will route traffic to different regions based on the [traffic routing][traffic-manager-routing] method you specify and the health of your application's endpoints.</span></span> <span data-ttu-id="8e30d-153">如果不使用流量管理器，则受限于部署的单个区域，从而会限制规模，增大用户的延迟，并导致应用程序在发生区域范围的服务中断时停机。</span><span class="sxs-lookup"><span data-stu-id="8e30d-153">Without Traffic Manager, you are limited to a single region for your deployment, which limits scale, increases latency for some users, and causes application downtime in the case of a region-wide service disruption.</span></span>

<span data-ttu-id="8e30d-154">**为负载均衡器和流量管理器配置并测试运行状况探测。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-154">**Configure and test health probes for your load balancers and traffic managers.**</span></span> <span data-ttu-id="8e30d-155">确保运行状况逻辑检查系统关键部件，并相应地对运行状况探测做出响应。</span><span class="sxs-lookup"><span data-stu-id="8e30d-155">Ensure that your health logic checks the critical parts of the system and responds appropriately to health probes.</span></span>

* <span data-ttu-id="8e30d-156">[Azure 流量管理器][traffic-manager]和 [Azure 负载均衡器][load-balancer]的运行状况探测充当特定的功能。</span><span class="sxs-lookup"><span data-stu-id="8e30d-156">The health probes for [Azure Traffic Manager][traffic-manager] and [Azure Load Balancer][load-balancer] serve a specific function.</span></span> <span data-ttu-id="8e30d-157">对于流量管理器，运行状况探测确定是否故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-157">For Traffic Manager, the health probe determines whether to fail over to another region.</span></span> <span data-ttu-id="8e30d-158">对于负载均衡器，它确定是否从轮转项目中删除某个 VM。</span><span class="sxs-lookup"><span data-stu-id="8e30d-158">For a load balancer, it determines whether to remove a VM from rotation.</span></span>      
* <span data-ttu-id="8e30d-159">对于流量管理器探测，运行状况终结点应检查所有关键依赖项，它们部署在同一区域，其故障应触发故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-159">For a Traffic Manager probe, your health endpoint should check any critical dependencies that are deployed within the same region, and whose failure should trigger a failover to another region.</span></span>  
* <span data-ttu-id="8e30d-160">对于负载均衡器，运行状况终结点应报告 VM 的运行状况。</span><span class="sxs-lookup"><span data-stu-id="8e30d-160">For a load balancer, the health endpoint should report the health of the VM.</span></span> <span data-ttu-id="8e30d-161">不要包含其他层或外部服务。</span><span class="sxs-lookup"><span data-stu-id="8e30d-161">Don't include other tiers or external services.</span></span> <span data-ttu-id="8e30d-162">否则，在 VM 外部发生的故障会导致负载均衡器从轮转项目中删除该 VM。</span><span class="sxs-lookup"><span data-stu-id="8e30d-162">Otherwise, a failure that occurs outside the VM will cause the load balancer to remove the VM from rotation.</span></span>
* <span data-ttu-id="8e30d-163">有关在应用程序中实施运行状况监视的指导，请参阅[运行状况终结点监视模式](https://msdn.microsoft.com/library/dn589789.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-163">For guidance on implementing health monitoring in your application, see [Health Endpoint Monitoring Pattern](https://msdn.microsoft.com/library/dn589789.aspx).</span></span>

<span data-ttu-id="8e30d-164">**监视第三方服务。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-164">**Monitor third-party services.**</span></span> <span data-ttu-id="8e30d-165">如果应用程序依赖于第三方服务，请确定这些第三方服务可能会在哪个位置出现何种故障，以及这些故障对应用程序造成的影响。</span><span class="sxs-lookup"><span data-stu-id="8e30d-165">If your application has dependencies on third-party services, identify where and how these third-party services can fail and what effect those failures will have on your application.</span></span> <span data-ttu-id="8e30d-166">第三方服务可能不包括监视和诊断，因此，必须记录其调用，并使用唯一标识符将其与应用程序的运行状况和诊断日志记录相关联。</span><span class="sxs-lookup"><span data-stu-id="8e30d-166">A third-party service may not include monitoring and diagnostics, so it's important to log your invocations of them and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span> <span data-ttu-id="8e30d-167">有关监视和诊断的成熟做法的详细信息，请参阅[监视和诊断指南][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-167">For more information on proven practices for monitoring and diagnostics, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="8e30d-168">**确保使用的任何第三方服务提供 SLA。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-168">**Ensure that any third-party service you consume provides an SLA.**</span></span> <span data-ttu-id="8e30d-169">如果应用程序依赖于某个第三方服务，但该服务不以 SLA 的形式保证可用性，则也无法保证应用程序的可用性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-169">If your application depends on a third-party service, but the third party provides no guarantee of availability in the form of an SLA, your application's availability also cannot be guaranteed.</span></span> <span data-ttu-id="8e30d-170">SLA 只与应用程序的最低可用性组件一样高。</span><span class="sxs-lookup"><span data-stu-id="8e30d-170">Your SLA is only as good as the least available component of your application.</span></span>

<span data-ttu-id="8e30d-171">**在适用的情况下，请实施复原模式以进行远程操作。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-171">**Implement resiliency patterns for remote operations where appropriate.**</span></span> <span data-ttu-id="8e30d-172">如果应用程序依赖于远程服务之间的通信，请遵循处理暂时性故障的设计模式，例如[重试模式][retry-pattern]和[断路器模式][circuit-breaker]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-172">If your application depends on communication between remote services, follow design patterns for dealing with transient failures, such as [Retry Pattern][retry-pattern], and [Circuit Breaker Pattern][circuit-breaker].</span></span> <span data-ttu-id="8e30d-173">有关详细信息，请参阅[复原策略](../resiliency/index.md#resiliency-strategies)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-173">For more information, see [Resiliency strategies](../resiliency/index.md#resiliency-strategies).</span></span>

<span data-ttu-id="8e30d-174">**尽量执行异步操作。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-174">**Implement asynchronous operations whenever possible.**</span></span> <span data-ttu-id="8e30d-175">同步操作可能会独占资源，并在调用方等待进程完成时阻塞其他操作。</span><span class="sxs-lookup"><span data-stu-id="8e30d-175">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="8e30d-176">设计应用程序的每个组成部分，以尽量执行异步操作。</span><span class="sxs-lookup"><span data-stu-id="8e30d-176">Design each part of your application to allow for asynchronous operations whenever possible.</span></span> <span data-ttu-id="8e30d-177">有关如何在 C# 中实现异步编程的详细信息，请参阅[使用 async 和 await 进行异步编程][asynchronous-c-sharp]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-177">For more information on how to implement asynchronous programming in C#, see [Asynchronous Programming with async and await][asynchronous-c-sharp].</span></span>

## <a name="data-management"></a><span data-ttu-id="8e30d-178">数据管理</span><span class="sxs-lookup"><span data-stu-id="8e30d-178">Data management</span></span>

<span data-ttu-id="8e30d-179">**了解应用程序数据源的复制方法。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-179">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="8e30d-180">应用程序数据将存储在不同的数据源中，因此具有不同的可用性要求。</span><span class="sxs-lookup"><span data-stu-id="8e30d-180">Your application data will be stored in different data sources and have different availability requirements.</span></span> <span data-ttu-id="8e30d-181">评估 Azure 中每种数据存储的复制方法，包括 [Azure 存储复制](/azure/storage/storage-redundancy/)和 [SQL 数据库活动异地复制](/azure/sql-database/sql-database-geo-replication-overview/)，确保满足应用程序的数据要求。</span><span class="sxs-lookup"><span data-stu-id="8e30d-181">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage Replication](/azure/storage/storage-redundancy/) and [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span>

<span data-ttu-id="8e30d-182">**确保没有任何用户帐户同时有权访问生产和备份数据。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-182">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="8e30d-183">如果单个用户帐户同时有权写入生产和备份源，则将会透露数据备份。</span><span class="sxs-lookup"><span data-stu-id="8e30d-183">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="8e30d-184">恶意用户可能有意删除所有数据，而普通用户可能意外删除数据。</span><span class="sxs-lookup"><span data-stu-id="8e30d-184">A malicious user could purposely delete all your data, while a regular user could accidentally delete it.</span></span> <span data-ttu-id="8e30d-185">将应用程序设计为限制每个用户帐户的权限，以便只有需要写访问权限的用户拥有写访问权限，并且只能写入生产或备份数据，但不能同时写入两者。</span><span class="sxs-lookup"><span data-stu-id="8e30d-185">Design your application to limit the permissions of each user account so that only the users that require write access have write access and it's only to either production or backup, but not both.</span></span>

<span data-ttu-id="8e30d-186">**阐述并测试数据源故障转移和故障回复过程。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-186">**Document your data source fail over and fail back process and test it.**</span></span> <span data-ttu-id="8e30d-187">当数据源发生灾难性的故障时，人工操作员必须遵循一套阐述的说明故障转移到新数据源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-187">In the case where your data source fails catastrophically, a human operator will have to follow a set of documented instructions to fail over to a new data source.</span></span> <span data-ttu-id="8e30d-188">如果阐述的步骤存在错误，操作员将无法成功遵循它们和故障转移资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-188">If the documented steps have errors, an operator will not be able to successfully follow them and fail over the resource.</span></span> <span data-ttu-id="8e30d-189">定期测试说明步骤，以验证操作员是否能够遵循它们成功故障转移和故障回复数据源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-189">Regularly test the instruction steps to verify that an operator following them is able to successfully fail over and fail back the data source.</span></span>

<span data-ttu-id="8e30d-190">**验证数据备份。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-190">**Validate your data backups.**</span></span> <span data-ttu-id="8e30d-191">定期通过运行脚本验证数据完整性、架构和查询，验证备份数据是否符合预期。</span><span class="sxs-lookup"><span data-stu-id="8e30d-191">Regularly verify that your backup data is what you expect by running a script to validate data integrity, schema, and queries.</span></span> <span data-ttu-id="8e30d-192">如果某个备份对还原数据源没有任何帮助，则就没有必要保留该备份。</span><span class="sxs-lookup"><span data-stu-id="8e30d-192">There's no point having a backup if it's not useful to restore your data sources.</span></span> <span data-ttu-id="8e30d-193">记录并报告任何不一致情况，以便能够修复备份服务。</span><span class="sxs-lookup"><span data-stu-id="8e30d-193">Log and report any inconsistencies so the backup service can be repaired.</span></span>

<span data-ttu-id="8e30d-194">**考虑使用异地冗余的存储帐户类型。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-194">**Consider using a storage account type that is geo-redundant.**</span></span> <span data-ttu-id="8e30d-195">Azure 存储帐户中存储的数据始终在本地复制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-195">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="8e30d-196">但是，在预配存储帐户时，有多个复制策略可供选择。</span><span class="sxs-lookup"><span data-stu-id="8e30d-196">However, there are multiple replication strategies to choose from when a Storage Account is provisioned.</span></span> <span data-ttu-id="8e30d-197">选择 [Azure 读取访问异地冗余存储 (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) 可以在整个区域不可用时（这种情况很罕见）保护应用程序数据。</span><span class="sxs-lookup"><span data-stu-id="8e30d-197">Select [Azure Read-Access Geo Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) to protect your application data against the rare case when an entire region becomes unavailable.</span></span>

> [!NOTE]
> <span data-ttu-id="8e30d-198">对于 VM，请不要依赖于 RA-GRS 复制来还原 VM 磁盘（VHD 文件），</span><span class="sxs-lookup"><span data-stu-id="8e30d-198">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="8e30d-199">而应该使用 [Azure 备份][azure-backup]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-199">Instead, use [Azure Backup][azure-backup].</span></span>   
>
>

## <a name="security"></a><span data-ttu-id="8e30d-200">“安全”</span><span class="sxs-lookup"><span data-stu-id="8e30d-200">Security</span></span>

<span data-ttu-id="8e30d-201">**针对分布式拒绝服务 (DDoS) 攻击实施应用程序级保护。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-201">**Implement application-level protection against distributed denial of service (DDoS) attacks.**</span></span> <span data-ttu-id="8e30d-202">Azure 服务可在网络层防范 DDos 攻击。</span><span class="sxs-lookup"><span data-stu-id="8e30d-202">Azure services are protected against DDos attacks at the network layer.</span></span> <span data-ttu-id="8e30d-203">但是，Azure 无法防范应用程序层攻击，因为很难将真实用户请求与恶意用户请求区分开来。</span><span class="sxs-lookup"><span data-stu-id="8e30d-203">However, Azure cannot protect against application-layer attacks, because it is difficult to distinguish between true user requests from malicious user requests.</span></span> <span data-ttu-id="8e30d-204">有关如何防范应用程序层 DDoS 攻击的详细信息，请参阅 [Microsoft Azure 网络安全性](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf)中的“防范 DDoS”部分（PDF 下载）。</span><span class="sxs-lookup"><span data-stu-id="8e30d-204">For more information on how to protect against application-layer DDoS attacks, see the "Protecting against DDoS" section of [Microsoft Azure Network Security](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (PDF download).</span></span>

<span data-ttu-id="8e30d-205">**对应用程序资源的访问权限实施最低特权原则。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-205">**Implement the principle of least privilege for access to the application's resources.**</span></span> <span data-ttu-id="8e30d-206">尽量限制对应用程序资源的默认访问权限。</span><span class="sxs-lookup"><span data-stu-id="8e30d-206">The default for access to the application's resources should be as restrictive as possible.</span></span> <span data-ttu-id="8e30d-207">只在经过批准后才授予更高级别的权限。</span><span class="sxs-lookup"><span data-stu-id="8e30d-207">Grant higher level permissions on an approval basis.</span></span> <span data-ttu-id="8e30d-208">默认授予对应用程序资源的过高访问权限可能导致某人有意或无意删除资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-208">Granting overly permissive access to your application's resources by default can result in someone purposely or accidentally deleting resources.</span></span> <span data-ttu-id="8e30d-209">Azure 提供[基于角色的访问控制](/azure/active-directory/role-based-access-built-in-roles/)用于管理用户特权，但必须验证具有自身权限系统（例如 SQL Server）的其他资源的最低特权。</span><span class="sxs-lookup"><span data-stu-id="8e30d-209">Azure provides [role-based access control](/azure/active-directory/role-based-access-built-in-roles/) to manage user privileges, but it's important to verify least privilege permissions for other resources that have their own permissions systems such as SQL Server.</span></span>

## <a name="testing"></a><span data-ttu-id="8e30d-210">测试</span><span class="sxs-lookup"><span data-stu-id="8e30d-210">Testing</span></span>

<span data-ttu-id="8e30d-211">**对应用程序执行故障转移和故障回复测试。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-211">**Perform failover and failback testing for your application.**</span></span> <span data-ttu-id="8e30d-212">如果不全面测试故障转移和故障回复，则无法确定在灾难恢复过程中，应用程序中的依赖服务以同步方式恢复正常运行。</span><span class="sxs-lookup"><span data-stu-id="8e30d-212">If you haven't fully tested failover and failback, you can't be certain that the dependent services in your application come back up in a synchronized manner during disaster recovery.</span></span> <span data-ttu-id="8e30d-213">确保应用程序的依赖服务按正确的顺序故障转移和故障回复。</span><span class="sxs-lookup"><span data-stu-id="8e30d-213">Ensure that your application's dependent services failover and fail back in the correct order.</span></span>

<span data-ttu-id="8e30d-214">**对应用程序执行故障注入测试。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-214">**Perform fault-injection testing for your application.**</span></span> <span data-ttu-id="8e30d-215">应用程序可能出于多种不同的原因而发生故障，例如，证书过期、VM 中系统资源耗尽或存储故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-215">Your application can fail for many different reasons, such as certificate expiration, exhaustion of system resources in a VM, or storage failures.</span></span> <span data-ttu-id="8e30d-216">在尽可能接近生产环境的环境中，通过模拟或触发实际故障来测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="8e30d-216">Test your application in an environment as close as possible to production, by simulating or triggering real failures.</span></span> <span data-ttu-id="8e30d-217">例如，删除证书、人为地消耗系统资源，或删除存储源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-217">For example, delete certificates, artificially consume system resources, or delete a storage source.</span></span> <span data-ttu-id="8e30d-218">验证应用程序是否能够从所有类型的故障（单独或组合的故障）中恢复。</span><span class="sxs-lookup"><span data-stu-id="8e30d-218">Verify your application's ability to recover from all types of faults, alone and in combination.</span></span> <span data-ttu-id="8e30d-219">检查故障是否不会通过系统传播或引发连锁故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-219">Check that failures are not propagating or cascading through your system.</span></span>

<span data-ttu-id="8e30d-220">**使用合成数据和真实用户数据在生产环境中运行测试。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-220">**Run tests in production using both synthetic and real user data.**</span></span> <span data-ttu-id="8e30d-221">测试环境和生产环境很少完全相同，因此，必须使用蓝/绿部署或金丝雀部署方法在生产环境中测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="8e30d-221">Test and production are rarely identical, so it's important to use blue/green or a canary deployment and test your application in production.</span></span> <span data-ttu-id="8e30d-222">这样，便可以在真实负载下在生产环境中测试应用程序，并确保它在完全部署后可按预期运行。</span><span class="sxs-lookup"><span data-stu-id="8e30d-222">This allows you to test your application in production under real load and ensure it will function as expected when fully deployed.</span></span>

## <a name="deployment"></a><span data-ttu-id="8e30d-223">部署</span><span class="sxs-lookup"><span data-stu-id="8e30d-223">Deployment</span></span>

<span data-ttu-id="8e30d-224">**阐述应用程序的发布过程。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-224">**Document the release process for your application.**</span></span> <span data-ttu-id="8e30d-225">如果不提供详细的发布过程文档，操作员可能部署错误的更新，或不当地配置应用程序的设置。</span><span class="sxs-lookup"><span data-stu-id="8e30d-225">Without detailed release process documentation, an operator might deploy a bad update or improperly configure settings for your application.</span></span> <span data-ttu-id="8e30d-226">明确定义和阐述发布过程，并确保将其提供给整个运营团队。</span><span class="sxs-lookup"><span data-stu-id="8e30d-226">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span> 

<span data-ttu-id="8e30d-227">**自动执行应用程序部署过程。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-227">**Automate your application's deployment process.**</span></span> <span data-ttu-id="8e30d-228">如果需要操作人员手动部署应用程序，则人为错误可能导致部署失败。</span><span class="sxs-lookup"><span data-stu-id="8e30d-228">If your operations staff is required to manually deploy your application, human error can cause the deployment to fail.</span></span> 

<span data-ttu-id="8e30d-229">**设计发布过程，以便尽量提高应用程序可用性。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-229">**Design your release process to maximize application availability.**</span></span> <span data-ttu-id="8e30d-230">如果发布过程要求服务在部署期间脱机，应用程序只能在重新联机后才可用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-230">If your release process requires services to go offline during deployment, your application will be unavailable until they come back online.</span></span> <span data-ttu-id="8e30d-231">使用[蓝/绿](http://martinfowler.com/bliki/BlueGreenDeployment.html)或[金丝雀发布](http://martinfowler.com/bliki/CanaryRelease.html)部署方法将应用程序部署到生产环境。</span><span class="sxs-lookup"><span data-stu-id="8e30d-231">Use the [blue/green](http://martinfowler.com/bliki/BlueGreenDeployment.html) or [canary release](http://martinfowler.com/bliki/CanaryRelease.html) deployment technique to deploy your application to production.</span></span> <span data-ttu-id="8e30d-232">这两种方法涉及到连同生产代码一起部署发布代码，因此，在发生故障时，发布代码的用户可重定向到生产代码。</span><span class="sxs-lookup"><span data-stu-id="8e30d-232">Both of these techniques involve deploying your release code alongside production code so users of release code can be redirected to production code in the event of a failure.</span></span>

<span data-ttu-id="8e30d-233">**记录并审核应用程序的部署。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-233">**Log and audit your application's deployments.**</span></span> <span data-ttu-id="8e30d-234">如果使用分阶段部署方法（例如蓝/绿或金丝雀发布方法），则生产环境中会运行的应用程序的多个版本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-234">If you use staged deployment techniques such as blue/green or canary releases there will be more than one version of your application running in production.</span></span> <span data-ttu-id="8e30d-235">如果出现问题，确定应用程序的哪个版本导致该问题至关重要。</span><span class="sxs-lookup"><span data-stu-id="8e30d-235">If a problem should occur, it's critical to determine which version of your application is causing a problem.</span></span> <span data-ttu-id="8e30d-236">实施可靠的日志记录策略来尽量多地捕获版本特定的信息。</span><span class="sxs-lookup"><span data-stu-id="8e30d-236">Implement a robust logging strategy to capture as much version-specific information as possible.</span></span>

<span data-ttu-id="8e30d-237">**为部署创建回滚计划。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-237">**Have a rollback plan for deployment.**</span></span> <span data-ttu-id="8e30d-238">应用程序部署可能失败，并导致应用程序不可用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-238">It's possible that your application deployment could fail and cause your application to become unavailable.</span></span> <span data-ttu-id="8e30d-239">请设计回滚过程，以恢复到上次已知正确的版本并最小化停机时间。</span><span class="sxs-lookup"><span data-stu-id="8e30d-239">Design a rollback process to go back to a last known good version and minimize downtime.</span></span> 

## <a name="operations"></a><span data-ttu-id="8e30d-240">操作</span><span class="sxs-lookup"><span data-stu-id="8e30d-240">Operations</span></span>

<span data-ttu-id="8e30d-241">**实施有关在应用程序中进行监视和警报的最佳做法。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-241">**Implement best practices for monitoring and alerting in your application.**</span></span> <span data-ttu-id="8e30d-242">不采用适当的监视、诊断和警报措施，就无法检测应用程序中的故障并提醒操作员解决故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-242">Without proper monitoring, diagnostics, and alerting, there is no way to detect failures in your application and alert an operator to fix them.</span></span> <span data-ttu-id="8e30d-243">有关详细信息，请参阅[监视和诊断指南][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-243">For more information, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="8e30d-244">**度量远程调用统计信息，并将信息提供给应用程序团队。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-244">**Measure remote call statistics and make the information available to the application team.**</span></span>  <span data-ttu-id="8e30d-245">如果不实时跟踪和报告远程调用统计信息并提供查看此信息的简单办法，则运营团队不能即时深入了解应用程序的运行状况。</span><span class="sxs-lookup"><span data-stu-id="8e30d-245">If you don't track and report remote call statistics in real time and provide an easy way to review this information, the operations team will not have an instantaneous view into the health of your application.</span></span> <span data-ttu-id="8e30d-246">如果仅度量平均远程调用时间，则没有足够的信息揭露服务中的问题。</span><span class="sxs-lookup"><span data-stu-id="8e30d-246">And if you only measure average remote call time, you will not have enough information to reveal issues in the services.</span></span> <span data-ttu-id="8e30d-247">汇总远程调用指标，例如延迟、吞吐量和 99 和 95 百分位中的错误。</span><span class="sxs-lookup"><span data-stu-id="8e30d-247">Summarize remote call metrics such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span> <span data-ttu-id="8e30d-248">针对指标执行统计分析，以发现每个百分位中发生的错误。</span><span class="sxs-lookup"><span data-stu-id="8e30d-248">Perform statistical analysis on the metrics to uncover errors that occur within each percentile.</span></span>

<span data-ttu-id="8e30d-249">**跟踪适当时间范围内的暂时性异常和重试数目。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-249">**Track the number of transient exceptions and retries over an appropriate timeframe.**</span></span> <span data-ttu-id="8e30d-250">如果不跟踪和监视各时间段的暂时性异常和重试，应用程序的重试逻辑中可能会隐藏问题或故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-250">If you don't track and monitor transient exceptions and retry attempts over time, it's possible that an issue or failure could be hidden by your application's retry logic.</span></span> <span data-ttu-id="8e30d-251">也就是说，如果监视和日志记录仅显示操作的成功或失败结果，则由于异常而必须多次重试的操作将会隐藏。</span><span class="sxs-lookup"><span data-stu-id="8e30d-251">That is, if your monitoring and logging only shows success or failure of an operation, the fact that the operation had to be retried multiple times due to exceptions will be hidden.</span></span> <span data-ttu-id="8e30d-252">在一段时间内异常的增加趋势指示此服务有问题，并可能发生故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-252">A trend of increasing exceptions over time indicates that the service is having an issue and may fail.</span></span> <span data-ttu-id="8e30d-253">有关详细信息，请参阅[重试服务指南][retry-service-guidance]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-253">For more information, see [Retry service specific guidance][retry-service-guidance].</span></span>

<span data-ttu-id="8e30d-254">**实施提醒操作员的提前警告系统。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-254">**Implement an early warning system that alerts an operator.**</span></span> <span data-ttu-id="8e30d-255">识别应用程序运行状况的关键性能指标，例如暂时性异常和远程调用延迟，并设置其中每个的适当阈值。</span><span class="sxs-lookup"><span data-stu-id="8e30d-255">Identify the key performance indicators of your application's health, such as transient exceptions and remote call latency, and set appropriate threshold values for each of them.</span></span> <span data-ttu-id="8e30d-256">达到阈值时，将警报发送到操作员。</span><span class="sxs-lookup"><span data-stu-id="8e30d-256">Send an alert to operations when the threshold value is reached.</span></span> <span data-ttu-id="8e30d-257">在它们变得严重并且需要恢复响应之前，设置确定问题的阈值级别。</span><span class="sxs-lookup"><span data-stu-id="8e30d-257">Set these thresholds at levels that identify issues before they become critical and require a recovery response.</span></span>

<span data-ttu-id="8e30d-258">**确保团队的多个人员经过培训，能够监视应用程序并执行任何手动恢复步骤。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-258">**Ensure that more than one person on the team is trained to monitor the application and perform any manual recovery steps.**</span></span> <span data-ttu-id="8e30d-259">如果团队中只有一个操作员可以监视应用程序和启动恢复步骤，此人将成为单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-259">If you only have a single operator on the team who can monitor the application and kick off recovery steps, that person becomes a single point of failure.</span></span> <span data-ttu-id="8e30d-260">培训多个检测和恢复人员，并确保始终至少有一个处于活动状态。</span><span class="sxs-lookup"><span data-stu-id="8e30d-260">Train multiple individuals on detection and recovery and make sure there is always at least one active at any time.</span></span>

<span data-ttu-id="8e30d-261">**确保应用程序不会达到 [Azure 订阅限制](/azure/azure-subscription-service-limits/)。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-261">**Ensure that your application does not run up against [Azure subscription limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="8e30d-262">Azure 订阅限制特定的资源类型，例如资源组数量、内核数量和存储帐户数量。</span><span class="sxs-lookup"><span data-stu-id="8e30d-262">Azure subscriptions have limits on certain resource types, such as number of resource groups, number of cores, and number of storage accounts.</span></span>  <span data-ttu-id="8e30d-263">如果应用程序的要求超过 Azure 订阅限制，请创建另一个 Azure 订阅并预配足够的资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-263">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span>

<span data-ttu-id="8e30d-264">**确保应用程序不会达到[每个服务的限制](/azure/azure-subscription-service-limits/)。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-264">**Ensure that your application does not run up against [per-service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="8e30d-265">每个 Azure 服务存在消耗量限制 &mdash; 例如，存储、吞吐量、连接、每秒请求数和其他指标的限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-265">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="8e30d-266">如果应用程序尝试使用的资源超过这些限制，则会发生故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-266">Your application will fail if it attempts to use resources beyond these limits.</span></span> <span data-ttu-id="8e30d-267">这会导致服务限制，并可能给受影响用户造成停机。</span><span class="sxs-lookup"><span data-stu-id="8e30d-267">This will result in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="8e30d-268">根据特定的服务和应用程序要求，通常可以通过纵向扩展（例如，选择另一个定价层）或横向扩展（添加新实例）避免这些限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-268">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (adding new instances).</span></span>  

<span data-ttu-id="8e30d-269">**将应用程序的存储要求设计为处在Azure 存储可伸缩性和性能目标的范围内。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-269">**Design your application's storage requirements to fall within Azure storage scalability and performance targets.**</span></span> <span data-ttu-id="8e30d-270">Azure 存储需在预定义的可伸缩性和性能目标内运行，因此请将应用程序设计为使用这些目标内的存储。</span><span class="sxs-lookup"><span data-stu-id="8e30d-270">Azure storage is designed to function within predefined scalability and performance targets, so design your application to utilize storage within those targets.</span></span> <span data-ttu-id="8e30d-271">如果超出这些目标，应用程序会受到存储限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-271">If you exceed these targets your application will experience storage throttling.</span></span> <span data-ttu-id="8e30d-272">若要解决此问题，请预配更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="8e30d-272">To fix this, provision additional Storage Accounts.</span></span> <span data-ttu-id="8e30d-273">如果达到存储帐户限制，请预配更多的 Azure 订阅，然后预配更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="8e30d-273">If you run up against the Storage Account limit, provision additional Azure Subscriptions and then provision additional Storage Accounts there.</span></span> <span data-ttu-id="8e30d-274">有关详细信息，请参阅 [Azure 存储可伸缩性和性能目标](/azure/storage/storage-scalability-targets/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-274">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/).</span></span>

<span data-ttu-id="8e30d-275">**为应用程序选择适当的 VM 大小。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-275">**Select the right VM size for your application.**</span></span> <span data-ttu-id="8e30d-276">在生产环境中度量 VM 的实际 CPU、内存、磁盘和 I/O，并验证选择的 VM 大小是否足够。</span><span class="sxs-lookup"><span data-stu-id="8e30d-276">Measure the actual CPU, memory, disk, and I/O of your VMs in production and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="8e30d-277">如果不足，当 VM 接近其限制时，应用程序可能遇到容量问题。</span><span class="sxs-lookup"><span data-stu-id="8e30d-277">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="8e30d-278">[Azure 中虚拟机的大小](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)中详细介绍了 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="8e30d-278">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="8e30d-279">**确定应用程序的工作负荷在一段时间内是稳定还是波动。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-279">**Determine if your application's workload is stable or fluctuating over time.**</span></span> <span data-ttu-id="8e30d-280">如果工作负荷在一段时间内波动，请使用 Azure VM 规模集自动缩放 VM 实例的数目。</span><span class="sxs-lookup"><span data-stu-id="8e30d-280">If your workload fluctuates over time, use Azure VM scale sets to automatically scale the number of VM instances.</span></span> <span data-ttu-id="8e30d-281">否则，必须手动增加或减少 VM 的数目。</span><span class="sxs-lookup"><span data-stu-id="8e30d-281">Otherwise, you will have to manually increase or decrease the number of VMs.</span></span> <span data-ttu-id="8e30d-282">有关详细信息，请参阅[虚拟机规模集概述](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-282">For more information, see the [Virtual Machine Scale Sets Overview](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="8e30d-283">**为 Azure SQL 数据库选择适当的服务层。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-283">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="8e30d-284">如果应用程序使用 Azure SQL 数据库，请确保选择适当的服务层。</span><span class="sxs-lookup"><span data-stu-id="8e30d-284">If your application uses Azure SQL Database, ensure that you have selected the appropriate service tier.</span></span> <span data-ttu-id="8e30d-285">如果选择的层无法应对应用程序的数据库事务单位 (DTU) 要求，则数据将受到限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-285">If you select a tier that is not able to handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="8e30d-286">有关选择正确服务计划的详细信息，请参阅 [SQL 数据库选项和性能：了解每个服务层提供的功能](/azure/sql-database/sql-database-service-tiers/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-286">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="8e30d-287">**创建与 Azure 支持部门交互的过程。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-287">**Create a process for interacting with Azure support.**</span></span> <span data-ttu-id="8e30d-288">如果在需要联系支持人员之前未设置联系 [Azure 支持部门](https://azure.microsoft.com/support/plans/)的过程，则停机时间将会延长，因为第一次需要导航支持过程。</span><span class="sxs-lookup"><span data-stu-id="8e30d-288">If the process for contacting [Azure support](https://azure.microsoft.com/support/plans/) is not set before the need to contact support arises, downtime will be prolonged as the support process is navigated for the first time.</span></span> <span data-ttu-id="8e30d-289">在设计应用程序复原能力的过程中，从一开始就包括与支持部门联系的过程，以及升级事务的过程。</span><span class="sxs-lookup"><span data-stu-id="8e30d-289">Include the process for contacting support and escalating issues as part of your application's resiliency from the outset.</span></span>

<span data-ttu-id="8e30d-290">**确保应用程序不会使用超过每个订阅的最大存储帐户数。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-290">**Ensure that your application doesn't use more than the maximum number of storage accounts per subscription.**</span></span> <span data-ttu-id="8e30d-291">Azure 允许为每个订阅最多使用 200 个存储帐户。</span><span class="sxs-lookup"><span data-stu-id="8e30d-291">Azure allows a maximum of 200 storage accounts per subscription.</span></span> <span data-ttu-id="8e30d-292">如果应用程序所需的存储帐户数超过订阅中当前提供的数目，则需要创建新的订阅，并在其中创建更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="8e30d-292">If your application requires more storage accounts than are currently available in your subscription, you will have to create a new subscription and create additional storage accounts there.</span></span> <span data-ttu-id="8e30d-293">有关详细信息，请参阅 [Azure 订阅和服务限制、配额与约束](/azure/azure-subscription-service-limits/#storage-limits)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-293">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>

<span data-ttu-id="8e30d-294">**确保应用程序不超过虚拟机磁盘的可伸缩性目标。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-294">**Ensure that your application doesn't exceed the scalability targets for virtual machine disks.**</span></span> <span data-ttu-id="8e30d-295">Azure IaaS VM 根据多种因素（包括 VM 大小和存储帐户类型）支持附加一些数据磁盘。</span><span class="sxs-lookup"><span data-stu-id="8e30d-295">An Azure IaaS VM supports attaching a number of data disks depending on several factors, including the VM size and type of storage account.</span></span> <span data-ttu-id="8e30d-296">如果应用程序超过虚拟机磁盘的可伸缩性目标，请预配更多的存储帐户并在其中创建虚拟机磁盘。</span><span class="sxs-lookup"><span data-stu-id="8e30d-296">If your application exceeds the scalability targets for virtual machine disks, provision additional storage accounts and create the virtual machine disks there.</span></span> <span data-ttu-id="8e30d-297">有关详细信息，请参阅 [Azure 存储可伸缩性和性能目标](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span><span class="sxs-lookup"><span data-stu-id="8e30d-297">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span></span>

## <a name="telemetry"></a><span data-ttu-id="8e30d-298">遥测</span><span class="sxs-lookup"><span data-stu-id="8e30d-298">Telemetry</span></span>

<span data-ttu-id="8e30d-299">**当应用程序在生产环境中运行时记录遥测数据。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-299">**Log telemetry data while the application is running in the production environment.**</span></span> <span data-ttu-id="8e30d-300">当应用程序在生产环境中运行时捕获可靠的遥测信息，否则没有足够的信息来诊断应用程序为用户提供服务时出现的问题的原因。</span><span class="sxs-lookup"><span data-stu-id="8e30d-300">Capture robust telemetry information while the application is running in the production environment or you will not have sufficient information to diagnose the cause of issues while it's actively serving users.</span></span> <span data-ttu-id="8e30d-301">有关详细信息，请参阅[监视和诊断][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-301">For more information, see [Monitoring and Diagnostics][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="8e30d-302">**使用异步模式实施日志记录。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-302">**Implement logging using an asynchronous pattern.**</span></span> <span data-ttu-id="8e30d-303">如果日志记录操作是同步的，则可能会阻止应用程序代码。</span><span class="sxs-lookup"><span data-stu-id="8e30d-303">If logging operations are synchronous, they might block your application code.</span></span> <span data-ttu-id="8e30d-304">确保将日志记录操作实施为异步操作。</span><span class="sxs-lookup"><span data-stu-id="8e30d-304">Ensure that your logging operations are implemented as asynchronous operations.</span></span>

<span data-ttu-id="8e30d-305">**跨服务边界关联日志数据。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-305">**Correlate log data across service boundaries.**</span></span> <span data-ttu-id="8e30d-306">在典型的 N 层应用程序中，用户请求可能遍历多个服务边界。</span><span class="sxs-lookup"><span data-stu-id="8e30d-306">In a typical n-tier application, a user request may traverse several service boundaries.</span></span> <span data-ttu-id="8e30d-307">例如，某个用户请求通常源自于 Web 层并传递到业务层，最后保留在数据层。</span><span class="sxs-lookup"><span data-stu-id="8e30d-307">For example, a user request typically originates in the web tier and is passed to the business tier and finally persisted in the data tier.</span></span> <span data-ttu-id="8e30d-308">在更复杂的情况下，可将用户请求分发到多个不同的服务和数据存储。</span><span class="sxs-lookup"><span data-stu-id="8e30d-308">In more complex scenarios, a user request may be distributed to many different services and data stores.</span></span> <span data-ttu-id="8e30d-309">确保日志记录系统跨服务边界关联调用，以便可以跟踪整个应用程序中的请求。</span><span class="sxs-lookup"><span data-stu-id="8e30d-309">Ensure that your logging system correlates calls across service boundaries so you can track the request throughout your application.</span></span>

## <a name="azure-resources"></a><span data-ttu-id="8e30d-310">Azure 资源</span><span class="sxs-lookup"><span data-stu-id="8e30d-310">Azure Resources</span></span>

<span data-ttu-id="8e30d-311">**使用 Azure 资源管理器模板预配资源。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-311">**Use Azure Resource Manager templates to provision resources.**</span></span> <span data-ttu-id="8e30d-312">使用资源管理器模板可以更轻松地通过 PowerShell 或 Azure CLI 自动完成部署，使部署过程更可靠。</span><span class="sxs-lookup"><span data-stu-id="8e30d-312">Resource Manager templates make it easier to automate deployments via PowerShell or the Azure CLI, which leads to a more reliable deployment process.</span></span> <span data-ttu-id="8e30d-313">有关详细信息，请参阅 [Azure 资源管理器概述][resource-manager]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-313">For more information, see [Azure Resource Manager overview][resource-manager].</span></span>

<span data-ttu-id="8e30d-314">**为资源指定有意义的名称。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-314">**Give resources meaningful names.**</span></span> <span data-ttu-id="8e30d-315">为资源指定有意义的名称可以更轻松地找到特定资源并了解其角色。</span><span class="sxs-lookup"><span data-stu-id="8e30d-315">Giving resources meaningful names makes it easier to locate a specific resource and understand its role.</span></span> <span data-ttu-id="8e30d-316">有关详细信息，请参阅 [Azure 资源的建议命名约定](../best-practices/naming-conventions.md)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-316">For more information, see [Naming conventions for Azure resources](../best-practices/naming-conventions.md)</span></span>

<span data-ttu-id="8e30d-317">**使用基于角色的访问控制 (RBAC)。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-317">**Use role-based access control (RBAC).**</span></span> <span data-ttu-id="8e30d-318">使用 RBAC 控制对已部署的 Azure 资源的访问。</span><span class="sxs-lookup"><span data-stu-id="8e30d-318">Use RBAC to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="8e30d-319">RBAC 允许向 DevOps 团队成员分配授权角色，防止意外删除或更改已部署的资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-319">RBAC lets you assign authorization roles to members of your DevOps team, to prevent accidental deletion or changes to deployed resources.</span></span> <span data-ttu-id="8e30d-320">有关详细信息，请参阅 [Azure 门户中的访问管理入门](/azure/active-directory/role-based-access-control-what-is/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-320">For more information, see [Get started with access management in the Azure portal](/azure/active-directory/role-based-access-control-what-is/)</span></span>

<span data-ttu-id="8e30d-321">**对 VM 等关键资源使用资源锁。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-321">**Use resource locks for critical resources, such as VMs.**</span></span> <span data-ttu-id="8e30d-322">资源锁可防止操作员意外删除资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-322">Resource locks prevent an operator from accidentally deleting a resource.</span></span> <span data-ttu-id="8e30d-323">有关详细信息，请参阅 [使用 Azure 资源管理器锁定资源](/azure/azure-resource-manager/resource-group-lock-resources/)</span><span class="sxs-lookup"><span data-stu-id="8e30d-323">For more information, see [Lock resources with Azure Resource Manager](/azure/azure-resource-manager/resource-group-lock-resources/)</span></span>

<span data-ttu-id="8e30d-324">**选择区域对。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-324">**Choose regional pairs.**</span></span> <span data-ttu-id="8e30d-325">部署到两个区域时，请从相同的区域对中选择区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-325">When deploying to two regions, choose regions from the same regional pair.</span></span> <span data-ttu-id="8e30d-326">如果发生大范围的服务中断，会优先恢复每个配对中的一个区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-326">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="8e30d-327">某些服务（例如异地冗余存储）提供自动复制到配对区域的功能。</span><span class="sxs-lookup"><span data-stu-id="8e30d-327">Some services such as Geo-Redundant Storage provide automatic replication to the paired region.</span></span> <span data-ttu-id="8e30d-328">有关详细信息，请参阅[业务连续性和灾难恢复 (BCDR)：Azure 配对区域](/azure/best-practices-availability-paired-regions)</span><span class="sxs-lookup"><span data-stu-id="8e30d-328">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions)</span></span>

<span data-ttu-id="8e30d-329">**按功能和生命周期组织资源组。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-329">**Organize resource groups by function and lifecycle.**</span></span>  <span data-ttu-id="8e30d-330">一般情况下，资源组应包含具有相同生命周期的资源。</span><span class="sxs-lookup"><span data-stu-id="8e30d-330">In general, a resource group should contain resources that share the same lifecycle.</span></span> <span data-ttu-id="8e30d-331">这样可以更方便地管理部署、删除测试部署和分配访问权限，减少意外删除或修改生产部署的可能性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-331">This makes it easier to manage deployments, delete test deployments, and assign access rights, reducing the chance that a production deployment is accidentally deleted or modified.</span></span> <span data-ttu-id="8e30d-332">为生产、开发和测试环境创建单独的资源组。</span><span class="sxs-lookup"><span data-stu-id="8e30d-332">Create separate resource groups for production, development, and test environments.</span></span> <span data-ttu-id="8e30d-333">在多区域部署中，请将每个区域的资源放入单独的资源组。</span><span class="sxs-lookup"><span data-stu-id="8e30d-333">In a multi-region deployment, put resources for each region into separate resource groups.</span></span> <span data-ttu-id="8e30d-334">这可以更方便地重新部署一个区域，而不影响其他区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-334">This makes it easier to redeploy one region without affecting the other region(s).</span></span>

## <a name="azure-services"></a><span data-ttu-id="8e30d-335">Azure 服务</span><span class="sxs-lookup"><span data-stu-id="8e30d-335">Azure Services</span></span>
<span data-ttu-id="8e30d-336">以下查检表项目适用于 Azure 中的特定服务。</span><span class="sxs-lookup"><span data-stu-id="8e30d-336">The following checklist items apply to specific services in Azure.</span></span>

- [<span data-ttu-id="8e30d-337">应用服务</span><span class="sxs-lookup"><span data-stu-id="8e30d-337">App Service</span></span>](#app-service)
- [<span data-ttu-id="8e30d-338">应用程序网关</span><span class="sxs-lookup"><span data-stu-id="8e30d-338">Application Gateway</span></span>](#application-gateway)
- [<span data-ttu-id="8e30d-339">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="8e30d-339">Cosmos DB</span></span>](#cosmos-db)
- [<span data-ttu-id="8e30d-340">Redis 缓存</span><span class="sxs-lookup"><span data-stu-id="8e30d-340">Redis Cache</span></span>](#redis-cache)
- [<span data-ttu-id="8e30d-341">搜索</span><span class="sxs-lookup"><span data-stu-id="8e30d-341">Search</span></span>](#search)
- [<span data-ttu-id="8e30d-342">存储</span><span class="sxs-lookup"><span data-stu-id="8e30d-342">Storage</span></span>](#storage)
- [<span data-ttu-id="8e30d-343">SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="8e30d-343">SQL Database</span></span>](#sql-database)
- [<span data-ttu-id="8e30d-344">VM 中运行的 SQL Server</span><span class="sxs-lookup"><span data-stu-id="8e30d-344">SQL Server running in a VM</span></span>](#sql-server-running-in-a-vm)
- [<span data-ttu-id="8e30d-345">流量管理器</span><span class="sxs-lookup"><span data-stu-id="8e30d-345">Traffic Manager</span></span>](#traffic-manager)
- [<span data-ttu-id="8e30d-346">虚拟机</span><span class="sxs-lookup"><span data-stu-id="8e30d-346">Virtual Machines</span></span>](#virtual-machines)
- [<span data-ttu-id="8e30d-347">虚拟网络</span><span class="sxs-lookup"><span data-stu-id="8e30d-347">Virtual Network</span></span>](#virtual-network)

### <a name="app-service"></a><span data-ttu-id="8e30d-348">应用服务</span><span class="sxs-lookup"><span data-stu-id="8e30d-348">App Service</span></span>

<span data-ttu-id="8e30d-349">**使用“标准”或“高级”层。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-349">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="8e30d-350">这些层支持过渡槽位和自动备份。</span><span class="sxs-lookup"><span data-stu-id="8e30d-350">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="8e30d-351">有关详细信息，请参阅 [Azure 应用服务计划深入概述](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span><span class="sxs-lookup"><span data-stu-id="8e30d-351">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>

<span data-ttu-id="8e30d-352">**避免纵向扩展或缩减。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-352">**Avoid scaling up or down.**</span></span> <span data-ttu-id="8e30d-353">应选择满足典型负载下的性能要求的层和实例大小，然后[横向扩展](/azure/app-service-web/web-sites-scale/)实例来处理流量的更改。</span><span class="sxs-lookup"><span data-stu-id="8e30d-353">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="8e30d-354">纵向扩展或缩减可能触发应用程序重启。</span><span class="sxs-lookup"><span data-stu-id="8e30d-354">Scaling up and down may trigger an application restart.</span></span>  

<span data-ttu-id="8e30d-355">**将配置存储为应用设置。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-355">**Store configuration as app settings.**</span></span> <span data-ttu-id="8e30d-356">使用应用设置将配置设置保存为应用设置。</span><span class="sxs-lookup"><span data-stu-id="8e30d-356">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="8e30d-357">在资源管理器模板中或使用 PowerShell 定义设置，以便可以在更可靠的自动部署/更新过程中应用这些设置。</span><span class="sxs-lookup"><span data-stu-id="8e30d-357">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="8e30d-358">有关详细信息，请参阅[在 Azure 应用服务中配置 Web 应用](/azure/app-service-web/web-sites-configure/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-358">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>

<span data-ttu-id="8e30d-359">**为生产和测试创建单独的应用服务计划。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-359">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="8e30d-360">不要使用生产部署中的槽位进行测试。</span><span class="sxs-lookup"><span data-stu-id="8e30d-360">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="8e30d-361">同一应用服务计划中的所有应用共享相同的 VM 实例。</span><span class="sxs-lookup"><span data-stu-id="8e30d-361">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="8e30d-362">如果将生产和测试部署放在同一个计划中，可能会对生产部署产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="8e30d-362">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="8e30d-363">例如，负载测试可能使实时生产站点降级。</span><span class="sxs-lookup"><span data-stu-id="8e30d-363">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="8e30d-364">如果将测试部署放入单独的计划，则可将其与生产版本相隔离。</span><span class="sxs-lookup"><span data-stu-id="8e30d-364">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>  

<span data-ttu-id="8e30d-365">**将 Web 应用与 Web API 相区分。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-365">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="8e30d-366">如果解决方案包含 Web 前端和 Web API，请考虑将它们分解为单独的应用服务应用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-366">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="8e30d-367">使用这种设计可以更方便地按工作负荷分解解决方案。</span><span class="sxs-lookup"><span data-stu-id="8e30d-367">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="8e30d-368">可以在单独的应用服务计划中运行 Web 应用和 API，以便对它们进行单独缩放。</span><span class="sxs-lookup"><span data-stu-id="8e30d-368">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="8e30d-369">如果一开始不需要该级别的可伸缩性，可以先将应用部署到同一计划中，以后再根据需要将其移至独立的计划中。</span><span class="sxs-lookup"><span data-stu-id="8e30d-369">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>

<span data-ttu-id="8e30d-370">**避免使用应用服务备份功能来备份 Azure SQL 数据库。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-370">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="8e30d-371">应该使用 [SQL 数据库自动备份][sql-backup]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-371">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="8e30d-372">应用服务备份会将数据库导出到 SQL .bacpac 文件，这会消耗 DTU。</span><span class="sxs-lookup"><span data-stu-id="8e30d-372">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>  

<span data-ttu-id="8e30d-373">**部署到过渡槽位。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-373">**Deploy to a staging slot.**</span></span> <span data-ttu-id="8e30d-374">创建部署槽位用于过渡。</span><span class="sxs-lookup"><span data-stu-id="8e30d-374">Create a deployment slot for staging.</span></span> <span data-ttu-id="8e30d-375">将应用程序更新部署到过渡槽位，并在交换到生产环境之前验证部署。</span><span class="sxs-lookup"><span data-stu-id="8e30d-375">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="8e30d-376">这可以减少生产环境中出现更新不当的可能性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-376">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="8e30d-377">此外，可确保所有实例在交换到生产环境之前已预热。</span><span class="sxs-lookup"><span data-stu-id="8e30d-377">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="8e30d-378">许多应用程序的预热和冷启动时间很长。</span><span class="sxs-lookup"><span data-stu-id="8e30d-378">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="8e30d-379">有关详细信息，请参阅[为 Azure 应用服务中的 Web 应用设置过渡环境](/azure/app-service-web/web-sites-staged-publishing/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-379">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="8e30d-380">**创建一个部署槽位用于保存上次已知正常 (LKG) 的部署。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-380">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="8e30d-381">将更新部署到生产环境时，请将前一个生产部署移到 LKG 槽位中。</span><span class="sxs-lookup"><span data-stu-id="8e30d-381">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="8e30d-382">这可以更方便地回滚错误部署。</span><span class="sxs-lookup"><span data-stu-id="8e30d-382">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="8e30d-383">如果以后发现问题，可以快速还原到 LKG 版本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-383">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="8e30d-384">有关详细信息，请参阅[基本 Web 应用程序](../reference-architectures/app-service-web-app/basic-web-app.md)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-384">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>

<span data-ttu-id="8e30d-385">**启用诊断日志记录**，包括应用程序日志记录和 Web 服务器日志记录。</span><span class="sxs-lookup"><span data-stu-id="8e30d-385">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="8e30d-386">日志记录对于监视和诊断很重要。</span><span class="sxs-lookup"><span data-stu-id="8e30d-386">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="8e30d-387">请参阅[在 Azure 应用服务中为 Web 应用启用诊断日志记录](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span><span class="sxs-lookup"><span data-stu-id="8e30d-387">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>

<span data-ttu-id="8e30d-388">**记录 Blob 存储的日志。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-388">**Log to blob storage.**</span></span> <span data-ttu-id="8e30d-389">这可以更方便地收集和分析数据。</span><span class="sxs-lookup"><span data-stu-id="8e30d-389">This makes it easier to collect and analyze the data.</span></span>

<span data-ttu-id="8e30d-390">**为日志创建单独的存储帐户。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-390">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="8e30d-391">不要对日志和应用程序数据使用相同的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="8e30d-391">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="8e30d-392">这有助于防止日志记录降低应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="8e30d-392">This helps to prevent logging from reducing application performance.</span></span>

<span data-ttu-id="8e30d-393">**监视性能。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-393">**Monitor performance.**</span></span> <span data-ttu-id="8e30d-394">使用 [New Relic](http://newrelic.com/) 或 [Application Insights](/azure/application-insights/app-insights-overview/) 等性能监视服务来监视承受负载时的应用程序性能和行为。</span><span class="sxs-lookup"><span data-stu-id="8e30d-394">Use a performance monitoring service such as [New Relic](http://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="8e30d-395">性能监视提供应用程序的实时深入信息。</span><span class="sxs-lookup"><span data-stu-id="8e30d-395">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="8e30d-396">可以使用它来诊断问题，以及执行故障根本原因分析。</span><span class="sxs-lookup"><span data-stu-id="8e30d-396">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

### <a name="application-gateway"></a><span data-ttu-id="8e30d-397">应用程序网关</span><span class="sxs-lookup"><span data-stu-id="8e30d-397">Application Gateway</span></span>

<span data-ttu-id="8e30d-398">**至少预配两个实例。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-398">**Provision at least two instances.**</span></span> <span data-ttu-id="8e30d-399">部署至少包含两个实例的应用程序网关。</span><span class="sxs-lookup"><span data-stu-id="8e30d-399">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="8e30d-400">单个实例会成为单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-400">A single instance is a single point of failure.</span></span> <span data-ttu-id="8e30d-401">使用两个或更多个实例实现冗余和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-401">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="8e30d-402">若要满足 [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/)，必须预配两个或更多个中型或大型实例。</span><span class="sxs-lookup"><span data-stu-id="8e30d-402">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/), you must provision two or more medium or larger instances.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="8e30d-403">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="8e30d-403">Cosmos DB</span></span>

<span data-ttu-id="8e30d-404">**跨区域复制数据库。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-404">**Replicate the database across regions.**</span></span> <span data-ttu-id="8e30d-405">Cosmos DB 允许将任意数量的 Azure 区域与 Cosmos DB 数据库帐户关联。</span><span class="sxs-lookup"><span data-stu-id="8e30d-405">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="8e30d-406">Cosmos DB 数据库可以包含一个写入区域和多个读取区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-406">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="8e30d-407">如果写入区域发生故障，可以从另一个副本读取。</span><span class="sxs-lookup"><span data-stu-id="8e30d-407">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="8e30d-408">客户端 SDK 会自动处理此操作。</span><span class="sxs-lookup"><span data-stu-id="8e30d-408">The Client SDK handles this automatically.</span></span> <span data-ttu-id="8e30d-409">还可以将写入区域故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="8e30d-409">You can also fail over the write region to another region.</span></span> <span data-ttu-id="8e30d-410">有关详细信息，请参阅[如何使用 Azure Cosmos DB 进行全局数据分配](/azure/cosmos-db/distribute-data-globally)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-410">For more information, see [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

### <a name="redis-cache"></a><span data-ttu-id="8e30d-411">Redis 缓存</span><span class="sxs-lookup"><span data-stu-id="8e30d-411">Redis Cache</span></span>

<span data-ttu-id="8e30d-412">**配置异地复制**。</span><span class="sxs-lookup"><span data-stu-id="8e30d-412">**Configure Geo-replication**.</span></span> <span data-ttu-id="8e30d-413">异地复制提供一种用于链接两个高级层 Azure Redis 缓存实例的机制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-413">Geo-replication provides a mechanism for linking two Premium tier Azure Redis Cache instances.</span></span> <span data-ttu-id="8e30d-414">写入主缓存的数据将复制到辅助只读缓存。</span><span class="sxs-lookup"><span data-stu-id="8e30d-414">Data written to the primary cache is replicated to a secondary read-only cache.</span></span> <span data-ttu-id="8e30d-415">有关详细信息，请参阅[如何为 Azure Redis 缓存配置异地复制功能](/azure/redis-cache/cache-how-to-geo-replication)</span><span class="sxs-lookup"><span data-stu-id="8e30d-415">For more information, see [How to configure Geo-replication for Azure Redis Cache](/azure/redis-cache/cache-how-to-geo-replication)</span></span>

<span data-ttu-id="8e30d-416">**配置数据持久性。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-416">**Configure data persistence.**</span></span> <span data-ttu-id="8e30d-417">使用 Redis 持久性可以在 Redis 中持久存储数据。</span><span class="sxs-lookup"><span data-stu-id="8e30d-417">Redis persistence allows you to persist data stored in Redis.</span></span> <span data-ttu-id="8e30d-418">还可以获取快照并备份数据，以便在出现硬件故障时进行加载。</span><span class="sxs-lookup"><span data-stu-id="8e30d-418">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="8e30d-419">有关详细信息，请参阅[如何为高级 Azure Redis 缓存配置数据持久性](/azure/redis-cache/cache-how-to-premium-persistence)</span><span class="sxs-lookup"><span data-stu-id="8e30d-419">For more information, see [How to configure data persistence for a Premium Azure Redis Cache](/azure/redis-cache/cache-how-to-premium-persistence)</span></span>

<span data-ttu-id="8e30d-420">如果将 Redis 缓存使用临时数据缓存而不是持久性存储，则这些建议可能不适用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-420">If you are using Redis Cache as a temporary data cache and not as a persistent store, these recommendations may not apply.</span></span> 

### <a name="search"></a><span data-ttu-id="8e30d-421">搜索</span><span class="sxs-lookup"><span data-stu-id="8e30d-421">Search</span></span>

<span data-ttu-id="8e30d-422">**预配多个副本。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-422">**Provision more than one replica.**</span></span> <span data-ttu-id="8e30d-423">至少使用两个副本实现读取高可用性，或至少使用三个副本实现读写高可用性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-423">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>

<span data-ttu-id="8e30d-424">**为多区域部署配置索引器。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-424">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="8e30d-425">若要进行多区域部署，请考虑使用索引连续性选项。</span><span class="sxs-lookup"><span data-stu-id="8e30d-425">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

  * <span data-ttu-id="8e30d-426">如果数据源是异地复制的，通常应该将每个区域性 Azure 搜索服务的每个索引器指向其本地数据源副本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-426">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="8e30d-427">但是，对于存储在 Azure SQL 数据库的大型数据集，不建议使用此方法。</span><span class="sxs-lookup"><span data-stu-id="8e30d-427">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="8e30d-428">原因在于，Azure 搜索无法从辅助 SQL 数据库副本执行增量索引，而只能从主副本执行。</span><span class="sxs-lookup"><span data-stu-id="8e30d-428">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="8e30d-429">应该将所有索引器指向主副本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-429">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="8e30d-430">故障转移后，请将 Azure 搜索索引器指向新的主副本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-430">After a failover, point the Azure Search indexers at the new primary replica.</span></span>  
  * <span data-ttu-id="8e30d-431">如果数据源不是异地复制的，请将多个索引器指向同一个数据源，以便多个区域中的 Azure 搜索服务可从数据源连续独立地编制索引。</span><span class="sxs-lookup"><span data-stu-id="8e30d-431">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="8e30d-432">有关详细信息，请参阅 [Azure 搜索性能和优化注意事项][search-optimization]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-432">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

### <a name="storage"></a><span data-ttu-id="8e30d-433">存储</span><span class="sxs-lookup"><span data-stu-id="8e30d-433">Storage</span></span>

<span data-ttu-id="8e30d-434">**对于应用程序数据，请使用读取访问异地冗余存储 (RA-GRS)。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-434">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="8e30d-435">RA-GRS 存储将数据复制到次要区域，并提供从次要区域的只读访问权限。</span><span class="sxs-lookup"><span data-stu-id="8e30d-435">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="8e30d-436">如果主要区域中发生存储故障，应用程序可以从次要区域读取数据。</span><span class="sxs-lookup"><span data-stu-id="8e30d-436">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="8e30d-437">有关详细信息，请参阅 [Azure 存储复制](/azure/storage/storage-redundancy/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-437">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>

<span data-ttu-id="8e30d-438">**对于 VM 磁盘，请使用托管磁盘。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-438">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="8e30d-439">[托管磁盘][managed-disks]为可用性集中的 VM 提供更高的可靠性，因为这些磁盘彼此充分隔离，可避免单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-439">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="8e30d-440">此外，托管磁盘不受存储帐户中创建的 VHD 的 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-440">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="8e30d-441">有关详细信息，请参阅[在 Azure 中管理 Windows 虚拟机的可用性][vm-manage-availability]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-441">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="8e30d-442">**对于队列存储，请在另一个区域中创建备份队列。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-442">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="8e30d-443">对于队列存储，只读副本的作用有限，因为无法将项排队或取消排队。</span><span class="sxs-lookup"><span data-stu-id="8e30d-443">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="8e30d-444">应在另一个区域中的某个存储帐户中创建备份队列。</span><span class="sxs-lookup"><span data-stu-id="8e30d-444">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="8e30d-445">如果发生存储故障，应用程序可以使用备份队列，直到主要区域重新可用。</span><span class="sxs-lookup"><span data-stu-id="8e30d-445">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="8e30d-446">这样，应用程序仍可处理新请求。</span><span class="sxs-lookup"><span data-stu-id="8e30d-446">That way, the application can still process new requests.</span></span>  

### <a name="sql-database"></a><span data-ttu-id="8e30d-447">SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="8e30d-447">SQL Database</span></span>

<span data-ttu-id="8e30d-448">**使用“标准”或“高级”层。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-448">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="8e30d-449">这些层提供更长的时间点还原期限（35 天）。</span><span class="sxs-lookup"><span data-stu-id="8e30d-449">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="8e30d-450">有关详细信息，请参阅 [SQL 数据库选项和性能](/azure/sql-database/sql-database-service-tiers/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-450">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="8e30d-451">**启用 SQL 数据库审核。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-451">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="8e30d-452">审核可用于诊断恶意攻击或人为错误。</span><span class="sxs-lookup"><span data-stu-id="8e30d-452">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="8e30d-453">有关详细信息，请参阅 [SQL 数据库审核入门](/azure/sql-database/sql-database-auditing-get-started/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-453">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>

<span data-ttu-id="8e30d-454">**使用活动异地复制**使用活动异地复制在一个不同的区域中创建可读取的辅助副本。</span><span class="sxs-lookup"><span data-stu-id="8e30d-454">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="8e30d-455">如果主数据库出现故障，或者只是需要脱机，可以手动故障转移到任何辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="8e30d-455">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="8e30d-456">在故障转移之前，辅助数据库将保持只读状态。</span><span class="sxs-lookup"><span data-stu-id="8e30d-456">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="8e30d-457">有关详细信息，请参阅 [SQL 数据库活动异地复制](/azure/sql-database/sql-database-geo-replication-overview/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-457">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="8e30d-458">**使用分片。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-458">**Use sharding.**</span></span> <span data-ttu-id="8e30d-459">考虑使用分片将数据库横向分区。</span><span class="sxs-lookup"><span data-stu-id="8e30d-459">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="8e30d-460">分片可提供故障隔离。</span><span class="sxs-lookup"><span data-stu-id="8e30d-460">Sharding can provide fault isolation.</span></span> <span data-ttu-id="8e30d-461">有关详细信息，请参阅[使用 Azure SQL 数据库进行横向扩展](/azure/sql-database/sql-database-elastic-scale-introduction/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-461">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>

<span data-ttu-id="8e30d-462">**发生人为错误后使用时间点还原进行恢复。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-462">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="8e30d-463">时间点还原可将数据库还原到以前的某个时间点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-463">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="8e30d-464">有关详细信息，请参阅[使用自动数据库备份恢复 Azure SQL 数据库][sql-restore]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-464">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

<span data-ttu-id="8e30d-465">**发生服务中断后使用异地还原进行恢复。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-465">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="8e30d-466">异地还原可从异地冗余的备份还原数据库。</span><span class="sxs-lookup"><span data-stu-id="8e30d-466">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="8e30d-467">有关详细信息，请参阅[使用自动数据库备份恢复 Azure SQL 数据库][sql-restore]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-467">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

### <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="8e30d-468">VM 中运行的 SQL Server</span><span class="sxs-lookup"><span data-stu-id="8e30d-468">SQL Server running in a VM</span></span>

<span data-ttu-id="8e30d-469">**复制数据库。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-469">**Replicate the database.**</span></span> <span data-ttu-id="8e30d-470">使用 SQL Server Always On 可用性组复制数据库。</span><span class="sxs-lookup"><span data-stu-id="8e30d-470">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="8e30d-471">当某个 SQL Server 实例发生故障时可提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="8e30d-471">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="8e30d-472">有关详细信息，请参阅[对 N 层应用程序运行 Windows VM](../reference-architectures/virtual-machines-windows/n-tier.md)</span><span class="sxs-lookup"><span data-stu-id="8e30d-472">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>

<span data-ttu-id="8e30d-473">**备份数据库**。</span><span class="sxs-lookup"><span data-stu-id="8e30d-473">**Back up the database**.</span></span> <span data-ttu-id="8e30d-474">如果已在使用 [Azure 备份](https://azure.microsoft.com/documentation/services/backup/)来备份 VM，请考虑[使用 DPM 为 SQL 工作负荷配置 Azure 备份](/azure/backup/backup-azure-backup-sql/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-474">If you are already using [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="8e30d-475">使用此方法时，将为组织配置一个备份管理员角色，并为 VM 和 SQL Server 创建统一的恢复过程。</span><span class="sxs-lookup"><span data-stu-id="8e30d-475">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="8e30d-476">否则，请使用 [Microsoft Azure 的 SQL Server 托管备份](https://msdn.microsoft.com/library/dn449496.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-476">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="8e30d-477">流量管理器</span><span class="sxs-lookup"><span data-stu-id="8e30d-477">Traffic Manager</span></span>

<span data-ttu-id="8e30d-478">**执行手动故障回复。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-478">**Perform manual failback.**</span></span> <span data-ttu-id="8e30d-479">流量管理器故障转移后，请执行手动故障回复而不是自动故障回复。</span><span class="sxs-lookup"><span data-stu-id="8e30d-479">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="8e30d-480">在故障回复之前，请验证是否所有应用程序子系统的运行状况都正常。</span><span class="sxs-lookup"><span data-stu-id="8e30d-480">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="8e30d-481">否则，可能会造成应用程序在数据中心之间来回转移的情况。</span><span class="sxs-lookup"><span data-stu-id="8e30d-481">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="8e30d-482">有关详细信息，请参阅[在多个区域中运行 VM 以实现高可用性](../reference-architectures/virtual-machines-windows/multi-region-application.md)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-482">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>

<span data-ttu-id="8e30d-483">**创建运行状况探测终结点。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-483">**Create a health probe endpoint.**</span></span> <span data-ttu-id="8e30d-484">创建一个自定义终结点用于报告应用程序的总体运行状况。</span><span class="sxs-lookup"><span data-stu-id="8e30d-484">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="8e30d-485">这样，当任何关键路径（而不仅仅是前端）发生故障时，流量管理器可故障转移。</span><span class="sxs-lookup"><span data-stu-id="8e30d-485">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="8e30d-486">如果任何关键依赖项不正常或不可访问，终结点应返回 HTTP 错误代码。</span><span class="sxs-lookup"><span data-stu-id="8e30d-486">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="8e30d-487">但是，不会报告非关键服务发生的错误。</span><span class="sxs-lookup"><span data-stu-id="8e30d-487">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="8e30d-488">否则，运行状况探测可能触发不必要的故障转移，并产生误报。</span><span class="sxs-lookup"><span data-stu-id="8e30d-488">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="8e30d-489">有关详细信息，请参阅[流量管理器终结点监视和故障转移](/azure/traffic-manager/traffic-manager-monitoring/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-489">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="8e30d-490">虚拟机</span><span class="sxs-lookup"><span data-stu-id="8e30d-490">Virtual Machines</span></span>

<span data-ttu-id="8e30d-491">**避免在单个 VM 上运行生产工作负荷。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-491">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="8e30d-492">单个 VM 部署不能弹性应对计划内或计划外维护。</span><span class="sxs-lookup"><span data-stu-id="8e30d-492">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="8e30d-493">应该将多个 VM 放入一个可用性集或 [VM 规模集](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)，并在其前面使用负载均衡器。</span><span class="sxs-lookup"><span data-stu-id="8e30d-493">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>

<span data-ttu-id="8e30d-494">**预配 VM 时指定可用性集。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-494">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="8e30d-495">目前，没有任何方法可以在预配 VM 后将 VM 添加到可用性集。</span><span class="sxs-lookup"><span data-stu-id="8e30d-495">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="8e30d-496">将新的 VM 添加到现有的可用性集时，请务必为该 VM 创建一个 NIC，并将该 NIC 添加到负载均衡器上的后端地址池。</span><span class="sxs-lookup"><span data-stu-id="8e30d-496">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="8e30d-497">否则，负载均衡器不会将网络流量路由到该 VM。</span><span class="sxs-lookup"><span data-stu-id="8e30d-497">Otherwise, the load balancer won't route network traffic to that VM.</span></span>

<span data-ttu-id="8e30d-498">**将每个应用程序层放入不同的可用性集。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-498">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="8e30d-499">在 N 层应用程序中，不要将不同层中的 VM 放入同一个可用性集。</span><span class="sxs-lookup"><span data-stu-id="8e30d-499">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="8e30d-500">可用性集中的 VM 放置在不同的容错域 (FD) 和更新域 (UD) 中。</span><span class="sxs-lookup"><span data-stu-id="8e30d-500">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="8e30d-501">但是，为了获得 FD 与 UD 的冗余优势，可用性集中的每个 VM 必须能够处理相同的客户端请求。</span><span class="sxs-lookup"><span data-stu-id="8e30d-501">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>

<span data-ttu-id="8e30d-502">**根据性能要求选择适当的 VM 大小。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-502">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="8e30d-503">将现有工作负荷转移到 Azure 时，首先请使用与本地服务器最匹配的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="8e30d-503">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="8e30d-504">然后测量与 CPU、内存和磁盘 IOPS 有关的实际工作负荷的性能，并根据需要调整大小。</span><span class="sxs-lookup"><span data-stu-id="8e30d-504">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="8e30d-505">这有助于确保应用程序在云环境中的行为符合预期。</span><span class="sxs-lookup"><span data-stu-id="8e30d-505">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="8e30d-506">此外，如果需要多个 NIC，请注意每种大小的 NIC 限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-506">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>

<span data-ttu-id="8e30d-507">**对 VHD 使用托管磁盘。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-507">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="8e30d-508">[托管磁盘][managed-disks]为可用性集中的 VM 提供更高的可靠性，因为这些磁盘彼此充分隔离，可避免单一故障点。</span><span class="sxs-lookup"><span data-stu-id="8e30d-508">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="8e30d-509">此外，托管磁盘不受存储帐户中创建的 VHD 的 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-509">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="8e30d-510">有关详细信息，请参阅[在 Azure 中管理 Windows 虚拟机的可用性][vm-manage-availability]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-510">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="8e30d-511">**将应用程序安装在数据磁盘而不是 OS 磁盘上。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-511">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="8e30d-512">否则，可能会达到磁盘大小限制。</span><span class="sxs-lookup"><span data-stu-id="8e30d-512">Otherwise, you may reach the disk size limit.</span></span>

<span data-ttu-id="8e30d-513">**使用 Azure 备份来备份 VM。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-513">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="8e30d-514">备份可防范意外的数据丢失。</span><span class="sxs-lookup"><span data-stu-id="8e30d-514">Backups protect against accidental data loss.</span></span> <span data-ttu-id="8e30d-515">有关详细信息，请参阅[使用恢复服务保管库保护 Azure VM](/azure/backup/backup-azure-vms-first-look-arm/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-515">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>

<span data-ttu-id="8e30d-516">**启用监视日志**，包括基本运行状况指标、基础结构日志和[启动诊断][boot-diagnostics]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-516">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="8e30d-517">如果 VM 陷入不可启动状态，启动诊断有助于诊断启动故障。</span><span class="sxs-lookup"><span data-stu-id="8e30d-517">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="8e30d-518">有关详细信息，请参阅 [Azure 诊断日志概述][diagnostics-logs]。</span><span class="sxs-lookup"><span data-stu-id="8e30d-518">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>

<span data-ttu-id="8e30d-519">**使用 AzureLogCollector 扩展。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-519">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="8e30d-520">（仅限 Windows VM。）此扩展可聚合 Azure 平台日志并将其上传到 Azure 存储，而无需操作员远程登录到 VM。</span><span class="sxs-lookup"><span data-stu-id="8e30d-520">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="8e30d-521">有关详细信息，请参阅 [AzureLogCollector 扩展](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-521">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="virtual-network"></a><span data-ttu-id="8e30d-522">虚拟网络</span><span class="sxs-lookup"><span data-stu-id="8e30d-522">Virtual Network</span></span>

<span data-ttu-id="8e30d-523">**要将公共 IP 地址加入白名单或阻止，请将 NSG 添加到子网。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-523">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="8e30d-524">阻止恶意用户的访问，或只允许有权访问应用程序的用户访问。</span><span class="sxs-lookup"><span data-stu-id="8e30d-524">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>  

<span data-ttu-id="8e30d-525">**创建自定义运行状况探测。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-525">**Create a custom health probe.**</span></span> <span data-ttu-id="8e30d-526">负载均衡器运行状况探测可以测试 HTTP 或 TCP。</span><span class="sxs-lookup"><span data-stu-id="8e30d-526">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="8e30d-527">如果 VM 运行 HTTP 服务器，HTTP 探测的运行状况指示效果比 TCP 探测更好。</span><span class="sxs-lookup"><span data-stu-id="8e30d-527">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="8e30d-528">对于 HTTP 探测，请使用自定义终结点来报告应用程序（包括所有关键依赖项）的总体运行状况。</span><span class="sxs-lookup"><span data-stu-id="8e30d-528">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="8e30d-529">有关详细信息，请参阅 [Azure 负载均衡器概述](/azure/load-balancer/load-balancer-overview/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-529">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>

<span data-ttu-id="8e30d-530">**不要阻止运行状况探测。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-530">**Don't block the health probe.**</span></span> <span data-ttu-id="8e30d-531">负载均衡器运行状况探测信息从已知 IP 地址 168.63.129.16 发送。</span><span class="sxs-lookup"><span data-stu-id="8e30d-531">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="8e30d-532">不要在任何防火墙策略或网络安全组 (NSG) 规则中阻止与此 IP 之间的流量。</span><span class="sxs-lookup"><span data-stu-id="8e30d-532">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="8e30d-533">阻止运行状况探测会导致负载均衡器从轮转项目中删除 VM。</span><span class="sxs-lookup"><span data-stu-id="8e30d-533">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>

<span data-ttu-id="8e30d-534">**启用负载均衡器日志记录。**</span><span class="sxs-lookup"><span data-stu-id="8e30d-534">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="8e30d-535">这些日志显示后端有多少个 VM 由于失败的探测响应而未收到网络流量。</span><span class="sxs-lookup"><span data-stu-id="8e30d-535">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="8e30d-536">有关详细信息，请参阅 [Azure 负载均衡器的 Log Analytics](/azure/load-balancer/load-balancer-monitor-log/)。</span><span class="sxs-lookup"><span data-stu-id="8e30d-536">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>


<!-- links -->
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale/
[asynchronous-c-sharp]: /dotnet/articles/csharp/async
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[azure-backup]: https://azure.microsoft.com/documentation/services/backup/
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[circuit-breaker]: ../patterns/circuit-breaker.md
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[fma]: ../resiliency/failure-mode-analysis.md
[resilient-deployment]: ../resiliency/index.md#resilient-deployment
[load-balancer]: /azure/load-balancer/load-balancer-overview/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[monitoring-and-diagnostics-guidance]: ../best-practices/monitoring.md
[resource-manager]: /azure/azure-resource-manager/resource-group-overview/
[retry-pattern]: ../patterns/retry.md
[retry-service-guidance]: ../best-practices/retry-service-specific.md
[search-optimization]: /azure/search/search-performance-optimization/
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[traffic-manager]: /azure/traffic-manager/traffic-manager-overview/
[traffic-manager-routing]: /azure/traffic-manager/traffic-manager-routing-methods/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
[vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/
