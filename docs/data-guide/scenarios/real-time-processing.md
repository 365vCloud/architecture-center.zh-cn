---
title: "实时处理"
description: 
author: zoinerTejada
ms:date: 02/12/2018
ms.openlocfilehash: f1054ce5e8c2053aa4f80d8b472604125ba47187
ms.sourcegitcommit: 90cf2de795e50571d597cfcb9b302e48933e7f18
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/14/2018
---
# <a name="real-time-processing"></a><span data-ttu-id="9c8be-102">实时处理</span><span class="sxs-lookup"><span data-stu-id="9c8be-102">Real time processing</span></span>

<span data-ttu-id="9c8be-103">实时处理以最低的延迟对实时捕获的数据流进行处理，以生成实时（或近乎实时）报告或自动响应。</span><span class="sxs-lookup"><span data-stu-id="9c8be-103">Real time processing deals with streams of data that are captured in real-time and processed with minimal latency to generate real-time (or near-real-time) reports or automated responses.</span></span> <span data-ttu-id="9c8be-104">例如，实时监视解决方案可以使用传感器数据来检测车流量。</span><span class="sxs-lookup"><span data-stu-id="9c8be-104">For example, a real-time traffic monitoring solution might use sensor data to detect high traffic volumes.</span></span> <span data-ttu-id="9c8be-105">可以使用此数据动态更新地图以显示交通堵塞情况，或自动启动堵塞车道或其他交通管理系统。</span><span class="sxs-lookup"><span data-stu-id="9c8be-105">This data could be used to dynamically update a map to show congestion, or automatically initiate high-occupancy lanes or other traffic management systems.</span></span>

![](./images/real-time-pipeline.png)

<span data-ttu-id="9c8be-106">实时处理定义为处理无约束输入数据流，处理时要求延迟极短 &mdash; 以毫秒或秒计。</span><span class="sxs-lookup"><span data-stu-id="9c8be-106">Real-time processing is defined as the processing of unbounded stream of input data, with very short latency requirements for processing &mdash; measured in milliseconds or seconds.</span></span> <span data-ttu-id="9c8be-107">此传入数据通常以非结构化或半结构化格式（例如 JSON）传送，其处理要求与[批处理](./batch-processing.md)相同，但周转时间更短，可支持实时使用。</span><span class="sxs-lookup"><span data-stu-id="9c8be-107">This incoming data typically arrives in an unstructured or semi-structured format, such as JSON, and has the same processing requirements as [batch processing](./batch-processing.md), but with shorter turnaround times to support real-time consumption.</span></span>

<span data-ttu-id="9c8be-108">处理的数据通常写入已针对分析和可视进行优化的分析数据存储。</span><span class="sxs-lookup"><span data-stu-id="9c8be-108">Processed data is often written to an analytical data store, which is optimized for analytics and visualization.</span></span> <span data-ttu-id="9c8be-109">还可以将处理的数据直接引入分析和报告层，以用于分析、商业智能和实时仪表板可视化。</span><span class="sxs-lookup"><span data-stu-id="9c8be-109">The processed data can also be ingested directly into the analytics and reporting layer for analysis, business intelligence, and real-time dashboard visualization.</span></span>

## <a name="challenges"></a><span data-ttu-id="9c8be-110">挑战</span><span class="sxs-lookup"><span data-stu-id="9c8be-110">Challenges</span></span>

<span data-ttu-id="9c8be-111">实时处理解决方案的最大难题之一是实时引入、处理和存储消息，尤其是消息量很大时。</span><span class="sxs-lookup"><span data-stu-id="9c8be-111">One of the big challenges of real-time processing solutions is to ingest, process, and store messages in real time, especially at high volumes.</span></span> <span data-ttu-id="9c8be-112">执行处理时不能阻塞引入管道。</span><span class="sxs-lookup"><span data-stu-id="9c8be-112">Processing must be done in such a way that it does not block the ingestion pipeline.</span></span> <span data-ttu-id="9c8be-113">数据存储必须支持大量写入。</span><span class="sxs-lookup"><span data-stu-id="9c8be-113">The data store must support high-volume writes.</span></span> <span data-ttu-id="9c8be-114">另一个难题是快速处理数据，例如，实时生成警报，或者在实时（或近乎实时）仪表板中显示数据。</span><span class="sxs-lookup"><span data-stu-id="9c8be-114">Another challenge is being able to act on the data quickly, such as generating alerts in real time or presenting the data in a real-time (or near-real-time) dashboard.</span></span>

## <a name="architecture"></a><span data-ttu-id="9c8be-115">体系结构</span><span class="sxs-lookup"><span data-stu-id="9c8be-115">Architecture</span></span>

<span data-ttu-id="9c8be-116">实时处理体系结构包含以下逻辑组件。</span><span class="sxs-lookup"><span data-stu-id="9c8be-116">A real-time processing architecture has the following logical components.</span></span>

- <span data-ttu-id="9c8be-117">**实时消息引入。**</span><span class="sxs-lookup"><span data-stu-id="9c8be-117">**Real-time message ingestion.**</span></span> <span data-ttu-id="9c8be-118">该体系结构必须提供一种方法来捕获和存储流处理使用方使用的实时消息。</span><span class="sxs-lookup"><span data-stu-id="9c8be-118">The architecture must include a way to capture and store real-time messages to be consumed by a stream processing consumer.</span></span> <span data-ttu-id="9c8be-119">在简单的场合中，可将此服务实施为简单的数据存储，以便将新消息放入其中的某个文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c8be-119">In simple cases, this service could be implemented as a simple data store in which new messages are deposited in a folder.</span></span> <span data-ttu-id="9c8be-120">但是，解决方案通常需要一个充当消息缓冲区的消息中转站，例如 Azure 事件中心。</span><span class="sxs-lookup"><span data-stu-id="9c8be-120">But often the solution requires a message broker, such as Azure Event Hubs, that acts as a buffer for the messages.</span></span> <span data-ttu-id="9c8be-121">消息中转站应支持横向扩展处理和可靠传递。</span><span class="sxs-lookup"><span data-stu-id="9c8be-121">The message broker should support scale-out processing and reliable delivery.</span></span>

- <span data-ttu-id="9c8be-122">**流处理。**</span><span class="sxs-lookup"><span data-stu-id="9c8be-122">**Stream processing.**</span></span> <span data-ttu-id="9c8be-123">捕获实时消息后，解决方案必须通过筛选、聚合以及准备用于分析的数据来处理消息。</span><span class="sxs-lookup"><span data-stu-id="9c8be-123">After capturing real-time messages, the solution must process them by filtering, aggregating, and otherwise preparing the data for analysis.</span></span>

- <span data-ttu-id="9c8be-124">**分析数据存储。**</span><span class="sxs-lookup"><span data-stu-id="9c8be-124">**Analytical data store.**</span></span> <span data-ttu-id="9c8be-125">许多大数据解决方案会先准备用于分析的数据，然后以结构化格式提供已处理的数据供分析工具查询。</span><span class="sxs-lookup"><span data-stu-id="9c8be-125">Many big data solutions are designed to prepare data for analysis and then serve the processed data in a structured format that can be queried using analytical tools.</span></span> 

- <span data-ttu-id="9c8be-126">**分析和报告。**</span><span class="sxs-lookup"><span data-stu-id="9c8be-126">**Analysis and reporting.**</span></span> <span data-ttu-id="9c8be-127">大多数大数据解决方案的目标是通过分析和报告提供对数据的见解。</span><span class="sxs-lookup"><span data-stu-id="9c8be-127">The goal of most big data solutions is to provide insights into the data through analysis and reporting.</span></span> 

## <a name="technology-choices"></a><span data-ttu-id="9c8be-128">技术选择</span><span class="sxs-lookup"><span data-stu-id="9c8be-128">Technology choices</span></span>

<span data-ttu-id="9c8be-129">建议对 Azure 中的实时处理解决方案选择以下技术。</span><span class="sxs-lookup"><span data-stu-id="9c8be-129">The following technologies are recommended choices for real-time processing solutions in Azure.</span></span>

### <a name="real-time-message-ingestion"></a><span data-ttu-id="9c8be-130">实时消息引入</span><span class="sxs-lookup"><span data-stu-id="9c8be-130">Real-time message ingestion</span></span>

- <span data-ttu-id="9c8be-131">**Azure 事件中心**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-131">**Azure Event Hubs**.</span></span> <span data-ttu-id="9c8be-132">Azure 事件中心是一个消息队列解决方案，每秒可引入数百万条事件消息。</span><span class="sxs-lookup"><span data-stu-id="9c8be-132">Azure Event Hubs is a message queuing solution for ingesting millions of event messages per second.</span></span> <span data-ttu-id="9c8be-133">多个使用者可以并行处理捕获的事件数据。</span><span class="sxs-lookup"><span data-stu-id="9c8be-133">The captured event data can be processed by multiple consumers in parallel.</span></span>
- <span data-ttu-id="9c8be-134">**Azure IoT 中心**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-134">**Azure IoT Hub**.</span></span> <span data-ttu-id="9c8be-135">Azure IoT 中心在连接到 Internet 的设备之间提供双向通信，并提供一个可以处理数百万个同时连接的设备的可缩放消息队列。</span><span class="sxs-lookup"><span data-stu-id="9c8be-135">Azure IoT Hub provides bi-directional communication between Internet-connected devices, and a scalable message queue that can handle millions of simultaneously connected devices.</span></span>
- <span data-ttu-id="9c8be-136">**Apache Kafka**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-136">**Apache Kafka**.</span></span> <span data-ttu-id="9c8be-137">Kafka 是一个开源消息队列和流处理应用程序，经扩展后每秒可以处理多个消息生成者发出的数百万条消息，并将它们路由到多个使用者。</span><span class="sxs-lookup"><span data-stu-id="9c8be-137">Kafka is an open source message queuing and stream processing application that can scale to handle millions of messages per second from multiple message producers, and route them to multiple consumers.</span></span> <span data-ttu-id="9c8be-138">在 Azure 中，Kafka 作为 HDInsight 群集类型提供。</span><span class="sxs-lookup"><span data-stu-id="9c8be-138">Kafka is available in Azure as an HDInsight cluster type.</span></span>

<span data-ttu-id="9c8be-139">有关详细信息，请参阅[实时消息引入](../technology-choices/real-time-ingestion.md)。</span><span class="sxs-lookup"><span data-stu-id="9c8be-139">For more information, see [Real-time message ingestion](../technology-choices/real-time-ingestion.md).</span></span>

### <a name="data-storage"></a><span data-ttu-id="9c8be-140">数据存储</span><span class="sxs-lookup"><span data-stu-id="9c8be-140">Data storage</span></span>

- <span data-ttu-id="9c8be-141">**Azure 存储 Blob 容器**或 **Azure Data Lake Store**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-141">**Azure Storage Blob Containers** or **Azure Data Lake Store**.</span></span> <span data-ttu-id="9c8be-142">传入的实时数据通常在消息中转站中捕获（如上所述），但在某些情况下，最好是监视文件夹中的新文件，并在创建或更新文件时对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="9c8be-142">Incoming real-time data is usually captured in a message broker (see above), but in some scenarios, it can make sense to monitor a folder for new files and process them as they are created or updated.</span></span> <span data-ttu-id="9c8be-143">此外，许多实时处理解决方案将流数据与静态引用数据合并，这些数据可存储在文件存储中。</span><span class="sxs-lookup"><span data-stu-id="9c8be-143">Additionally, many real-time processing solutions combine streaming data with static reference data, which can be stored in a file store.</span></span> <span data-ttu-id="9c8be-144">最后，可将文件存储用作捕获的实时数据的输出目标，以便存档，或者在 [lambda 体系结构](../concepts/big-data.md#lambda-architecture)中做进一步的批处理。</span><span class="sxs-lookup"><span data-stu-id="9c8be-144">Finally, file storage may be used as an output destination for captured real-time data for archiving, or for further batch processing in a [lambda architecture](../concepts/big-data.md#lambda-architecture).</span></span>

<span data-ttu-id="9c8be-145">有关详细信息，请参阅[数据存储](../technology-choices/data-storage.md)。</span><span class="sxs-lookup"><span data-stu-id="9c8be-145">For more information, see [Data storage](../technology-choices/data-storage.md).</span></span>

### <a name="stream-processing"></a><span data-ttu-id="9c8be-146">流处理</span><span class="sxs-lookup"><span data-stu-id="9c8be-146">Stream processing</span></span>

- <span data-ttu-id="9c8be-147">**Azure 流分析**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-147">**Azure Stream Analytics**.</span></span> <span data-ttu-id="9c8be-148">Azure 流分析可以针对无约束的数据流运行永久查询。</span><span class="sxs-lookup"><span data-stu-id="9c8be-148">Azure Stream Analytics can run perpetual queries against an unbounded stream of data.</span></span> <span data-ttu-id="9c8be-149">这些查询使用存储或消息中转站中的数据流、根据时态窗口筛选和聚合数据，并将结果写入接收器（例如存储）、数据库，或直接写入 Power BI 中的报表。</span><span class="sxs-lookup"><span data-stu-id="9c8be-149">These queries consume streams of data from storage or message brokers, filter and aggregate the data based on temporal windows, and write the results to sinks such as storage, databases, or directly to reports in Power BI.</span></span>
- <span data-ttu-id="9c8be-150">**Storm**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-150">**Storm**.</span></span> <span data-ttu-id="9c8be-151">Apache Storm 是适用于流处理的开源框架，它使用 Spout 和 Bolt 的拓扑，从实时流数据源使用、处理和输出结果。</span><span class="sxs-lookup"><span data-stu-id="9c8be-151">Apache Storm is an open source framework for stream processing that uses a topology of spouts and bolts to consume, process, and output the results from real-time streaming data sources.</span></span> <span data-ttu-id="9c8be-152">可以在 Azure HDInsight 群集中预配 Storm，并以 Java 或 C# 实施拓扑。</span><span class="sxs-lookup"><span data-stu-id="9c8be-152">You can provision Storm in an Azure HDInsight cluster, and implement a topology in Java or C#.</span></span>
- <span data-ttu-id="9c8be-153">**Spark Streaming**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-153">**Spark Streaming**.</span></span> <span data-ttu-id="9c8be-154">Apache Spark 是适用于常规数据处理的开源分布式平台。</span><span class="sxs-lookup"><span data-stu-id="9c8be-154">Apache Spark is an open source distributed platform for general data processing.</span></span> <span data-ttu-id="9c8be-155">Spark 提供 Spark 流 API，在其中可以使用受支持的任何 Spark 语言（包括 Java、Scala 和 Python）编写代码。</span><span class="sxs-lookup"><span data-stu-id="9c8be-155">Spark provides the Spark Streaming API, in which you can write code in any supported Spark language, including Java, Scala, and Python.</span></span> <span data-ttu-id="9c8be-156">Spark 2.0 引入了 Spark 结构化流 API，该 API 提供更简单且更一致的编程模型。</span><span class="sxs-lookup"><span data-stu-id="9c8be-156">Spark 2.0 introduced the Spark Structured Streaming API, which provides a simpler and more consistent programming model.</span></span> <span data-ttu-id="9c8be-157">Spark 2.0 在 Azure HDInsight 群集中提供。</span><span class="sxs-lookup"><span data-stu-id="9c8be-157">Spark 2.0 is available in an Azure HDInsight cluster.</span></span>

<span data-ttu-id="9c8be-158">有关详细信息，请参阅[流处理](../technology-choices/stream-processing.md)。</span><span class="sxs-lookup"><span data-stu-id="9c8be-158">For more information, see [Stream processing](../technology-choices/stream-processing.md).</span></span>

### <a name="analytical-data-store"></a><span data-ttu-id="9c8be-159">分析数据存储</span><span class="sxs-lookup"><span data-stu-id="9c8be-159">Analytical data store</span></span>

- <span data-ttu-id="9c8be-160">**SQL 数据仓库**、**HBase**、**Spark** 或 **Hive**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-160">**SQL Data Warehouse**, **HBase**, **Spark**, or **Hive**.</span></span> <span data-ttu-id="9c8be-161">可将处理的实时数据存储在 Azure SQL 数据仓库等关系数据库、HBase 等 NoSQL 存储中，或者将其作为文件存储在分布式存储中，然后，可以根据这些文件来定义和查询 Spark 或 Hive 表。</span><span class="sxs-lookup"><span data-stu-id="9c8be-161">Processed real-time data can be stored in a relational database such Azure SQL Data Warehouse, a NoSQL store such as HBase, or as files in distributed storage over which Spark or Hive tables can be defined and queried.</span></span>

<span data-ttu-id="9c8be-162">有关详细信息，请参阅[分析数据存储](../technology-choices/analytical-data-stores.md)。</span><span class="sxs-lookup"><span data-stu-id="9c8be-162">For more information, see [Analytical data stores](../technology-choices/analytical-data-stores.md).</span></span>

### <a name="analytics-and-reporting"></a><span data-ttu-id="9c8be-163">分析和报告</span><span class="sxs-lookup"><span data-stu-id="9c8be-163">Analytics and reporting</span></span>

- <span data-ttu-id="9c8be-164">**Azure Analysis Services**、**Power BI** 和 **Microsoft Excel**。</span><span class="sxs-lookup"><span data-stu-id="9c8be-164">**Azure Analysis Services**, **Power BI**, and **Microsoft Excel**.</span></span> <span data-ttu-id="9c8be-165">像批处理的数据一样，存储在分析数据存储中的已处理的实时数据可用于历史报告和分析。</span><span class="sxs-lookup"><span data-stu-id="9c8be-165">Processed real-time data that is stored in an analytical data store can be used for historical reporting and analysis in the same way as batch processed data.</span></span> <span data-ttu-id="9c8be-166">此外，可以使用 Power BI 从延迟足够低的分析数据源发布实时（或近乎实时）的报告和可视化效果；在某些情况下，还可以直接从流处理的输出发布。</span><span class="sxs-lookup"><span data-stu-id="9c8be-166">Additionally, Power BI can be used to publish real-time (or near-real-time) reports and visualizations from analytical data sources where latency is sufficiently low, or in some cases directly from the stream processing output.</span></span>

<span data-ttu-id="9c8be-167">有关详细信息，请参阅[分析和报告](../technology-choices/analysis-visualizations-reporting.md)。</span><span class="sxs-lookup"><span data-stu-id="9c8be-167">For more information, see [Analytics and reporting](../technology-choices/analysis-visualizations-reporting.md).</span></span>

<span data-ttu-id="9c8be-168">在单纯的实时解决方案中，大多数处理业务流程由消息引入和流处理组件管理。</span><span class="sxs-lookup"><span data-stu-id="9c8be-168">In a purely real-time solution, most of the processing orchestration is managed by the message ingestion and stream processing components.</span></span> <span data-ttu-id="9c8be-169">但是，在结合批处理与实时处理的 lambda 体系结构中，可能需要使用 Azure 数据工厂或 Apache Oozie 和 Sqoop 等业务流程框架来管理捕获的实时数据的批处理工作流。</span><span class="sxs-lookup"><span data-stu-id="9c8be-169">However, in a lambda architecture that combines batch processing and real-time processing, you may need to use an orchestration framework such as Azure Data Factory or Apache Oozie and Sqoop to manage batch workflows for captured real-time data.</span></span>

